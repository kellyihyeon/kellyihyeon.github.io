<!doctype html>
<html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta><title>Insight Archive</title><link rel="manifest" href="/manifest.json"><meta name="application-name" content="Insight Archive"><meta name="msapplication-TileImage" content="/img/logo.png"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-title" content="Insight Archive"><meta name="apple-mobile-web-app-status-bar-style" content="default"><meta property="og:type" content="blog"><meta property="og:title" content="Insight Archive"><meta property="og:url" content="https://kellyihyeon.github.io/"><meta property="og:site_name" content="Insight Archive"><meta property="og:locale" content="en_US"><meta property="og:image" content="https://kellyihyeon.github.io/img/og_image.png"><meta property="article:author" content="yihyeon"><meta property="twitter:card" content="summary"><meta property="twitter:image:src" content="https://kellyihyeon.github.io/img/og_image.png"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://kellyihyeon.github.io"},"headline":"Insight Archive","image":["https://kellyihyeon.github.io/img/og_image.png"],"author":{"@type":"Person","name":"yihyeon"},"publisher":{"@type":"Organization","name":"Insight Archive","logo":{"@type":"ImageObject","url":"https://kellyihyeon.github.io/img/logo.png"}},"description":""}</script><link rel="icon" href="/img/logo.png"><link rel="stylesheet" href="https://use.fontawesome.com/releases/v6.0.0/css/all.css"><link data-pjax rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@11.7.0/styles/atom-one-light.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Ubuntu:wght@400;600&amp;family=Source+Code+Pro"><link data-pjax rel="stylesheet" href="/css/default.css"><style>body>.footer,body>.navbar,body>.section{opacity:0}</style><!--!--><!--!--><!--!--><!--!--><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@1.10.0/dist/css/lightgallery.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/justifiedGallery@3.8.1/dist/css/justifiedGallery.min.css"><!--!--><!--!--><!--!--><style>.pace{-webkit-pointer-events:none;pointer-events:none;-webkit-user-select:none;-moz-user-select:none;user-select:none}.pace-inactive{display:none}.pace .pace-progress{background:#3273dc;position:fixed;z-index:2000;top:0;right:100%;width:100%;height:2px}</style><script src="https://cdn.jsdelivr.net/npm/pace-js@1.2.4/pace.min.js"></script><!--!--><!--!--><!-- hexo injector head_end start --><script>
  (function () {
      function switchTab() {
          if (!location.hash) {
            return;
          }

          const id = '#' + CSS.escape(location.hash.substring(1));
          const $tabMenu = document.querySelector(`.tabs a[href="${id}"]`);
          if (!$tabMenu) {
            return;
          }

          const $tabMenuContainer = $tabMenu.parentElement.parentElement;
          Array.from($tabMenuContainer.children).forEach($menu => $menu.classList.remove('is-active'));
          Array.from($tabMenuContainer.querySelectorAll('a'))
              .map($menu => document.getElementById($menu.getAttribute("href").substring(1)))
              .forEach($content => $content.classList.add('is-hidden'));

          if ($tabMenu) {
              $tabMenu.parentElement.classList.add('is-active');
          }
          const $activeTab = document.querySelector(id);
          if ($activeTab) {
              $activeTab.classList.remove('is-hidden');
          }
      }
      switchTab();
      window.addEventListener('hashchange', switchTab, false);
  })();
  </script><!-- hexo injector head_end end --><meta name="generator" content="Hexo 7.3.0"></head><body class="is-2-column"><nav class="navbar navbar-main"><div class="container navbar-container"><div class="navbar-brand justify-content-center"><a class="navbar-item navbar-logo" href="/"><img src="/img/logo.png" alt="Insight Archive" height="28"></a></div><div class="navbar-menu"><div class="navbar-start"><a class="navbar-item is-active" href="/">Home</a><a class="navbar-item" href="/archives">Archives</a><a class="navbar-item" href="/categories">Categories</a><a class="navbar-item" href="/tags">Tags</a><a class="navbar-item" href="/about">About</a></div><div class="navbar-end"><a class="navbar-item" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/ppoffice/hexo-theme-icarus"><i class="fab fa-github"></i></a><a class="navbar-item search" title="Search" href="javascript:;"><i class="fas fa-search"></i></a></div></div></div></nav><section class="section"><div class="container"><div class="columns"><div class="column order-2 column-main is-9-tablet is-9-desktop is-9-widescreen"><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-9 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Posted&nbsp;2024-10-07</span><span class="level-item">Updated&nbsp;<time dateTime="2024-10-07T15:26:10.332Z" title="10/8/2024, 12:26:10 AM">2024-10-08</time></span><span class="level-item"><a class="link-muted" href="/categories/%EC%9D%B8%ED%94%84%EB%9D%BC/">인프라</a></span><span class="level-item">28 minutes read (About 4133 words)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2024/10/07/Nginx%EB%A1%9C-%EC%8A%A4%ED%94%84%EB%A7%81-%EB%B6%80%ED%8A%B8-8080%EB%B2%88%EC%9C%BC%EB%A1%9C-%ED%8F%AC%ED%8A%B8-%ED%8F%AC%EC%9B%8C%EB%94%A9-%ED%95%98%EA%B8%B0/">Nginx 로 스프링 부트 8080번으로 포트포워딩 하기</a></p><div class="content"><h1 id="들어가며"><a href="#들어가며" class="headerlink" title="들어가며"></a>들어가며</h1><p><img src="/../image/8080%ED%8F%AC%ED%8A%B8_%EC%A0%91%EC%86%8D.png" alt="8080 포트번호를 써줘야만 하는 내 서비스"></p>
<p>도메인을 구입하고 ec2 인스턴스와 연결을 시켜주었기 때문에 IP주소가 아닌 도메인 주소로 스탠스 서비스에 접속할 수 있게 됐어요. 그런데 해당 서비스에 접속하려면 8080 포트 번호를 써줘야만 해요. </p>
<p>스프링 부트의 내장 웹 서버인 톰캣은 기본적으로 8080 포트이기 때문에 스프링 부트 프로젝트는 8080 포트에서 동작해요. 포트 번호를 생략하면 해당 서비스와 연결이 되지 않아요. <strong>‘사이트에 연결할 수 없음’</strong> 이라는 메세지만 볼 수 있을 뿐입니다. </p>
<p><a target="_blank" rel="noopener" href="http://team-stance.com/">team-stance.com</a> 의 80번지와 8080번지는 다른 주소이기 때문이죠! 그래서 포트 포워딩을 해보려고 하는데요. 특정 포트 번호에 대한 요청을 8080 포트 번호로 전달해 줄 거예요. </p>
<p>SSL 인증서를 발급받아 프로젝트에 HTTPS 를 적용하는 과정에서 많은 시행 착오를 겪었습니다… 🥲 이 글에서는 Nginx 로 443 포트의 요청을 8080 포트에서 실행 중인 스프링 부트로 전달하는 과정에서 발생한 이슈를 공유하고자 합니다.</p>
<h1 id="1-Nginx-를-설치하고-Nginx-의-응답을-확인하자"><a href="#1-Nginx-를-설치하고-Nginx-의-응답을-확인하자" class="headerlink" title="1. Nginx 를 설치하고 Nginx 의 응답을 확인하자"></a>1. Nginx 를 설치하고 Nginx 의 응답을 확인하자</h1><p>ec2 인스턴스의 운영체제가 <strong>Amazon Linux</strong> 라 명령어는 해당 운영체제 기준으로 설명 드리겠습니다. </p>
<h2 id="1-1-Nginx-설치"><a href="#1-1-Nginx-설치" class="headerlink" title="1.1. Nginx 설치"></a>1.1. Nginx 설치</h2><p>ec2에 ssh 접속을 한 후 아래 명령어로 Nginx 를 설치합니다.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> yum install -y nginx</span><br></pre></td></tr></table></figure>

<h2 id="1-2-Nginx-상태-확인"><a href="#1-2-Nginx-상태-확인" class="headerlink" title="1.2. Nginx 상태 확인"></a>1.2. Nginx 상태 확인</h2><p>아래의 명령어로 Nginx의 상태를 확인해봅니다.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl status nginx</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">○ nginx.service - The nginx HTTP and reverse proxy server</span><br><span class="line">     Loaded: loaded (/usr/lib/systemd/system/nginx.service; disabled; preset: disabled)</span><br><span class="line">     Active: inactive (dead)</span><br></pre></td></tr></table></figure>

<p><code>Active: inactive (dead)</code> 는 Nginx 가 실행되고 있지 않다는 뜻이에요. Nginx가 응답하지 않는 상태이므로 Nginx를 시작해야겠죠?</p>
<h2 id="1-3-Nginx-실행"><a href="#1-3-Nginx-실행" class="headerlink" title="1.3. Nginx  실행"></a>1.3. Nginx  실행</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> systemctl start nginx</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl status nginx</span><br></pre></td></tr></table></figure>

<p>Nginx 를 실행한 후 다시 상태를 확인해 봅시다. 아래와 같은 결과가 나온다면 Nginx 가 정상적으로 실행되고 있다는 뜻이에요.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">● nginx.service - The nginx HTTP and reverse proxy server</span><br><span class="line">   Loaded: loaded (/usr/lib/systemd/system/nginx.service; enabled; preset: disabled)</span><br><span class="line">   Active: active (running) since Sat 2024-10-06 14:52:03 UTC; 1h 10min ago</span><br><span class="line"> Main PID: 12345 (nginx)</span><br><span class="line">    Tasks: 2 (<span class="built_in">limit</span>: 1153)</span><br><span class="line">   Memory: 1.5M</span><br><span class="line">   CGroup: /system.slice/nginx.service</span><br><span class="line">           ├─12345 nginx: master process /usr/sbin/nginx</span><br><span class="line">           └─12346 nginx: worker process</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="1-4-Nginx-서버의-설정-파일-확인"><a href="#1-4-Nginx-서버의-설정-파일-확인" class="headerlink" title="1.4. Nginx 서버의 설정 파일 확인"></a>1.4. Nginx 서버의 설정 파일 확인</h2><p>아래의 명령어로 Nginx 서버의 설정 파일에 오류가 있는지 확인해봅니다.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nginx -t</span><br></pre></td></tr></table></figure>

<p>설정 파일에 오류가 없으면 아래와 같은 메시지가 출력돼요.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">nginx: the configuration file /etc/nginx/nginx.conf syntax is ok</span><br><span class="line">nginx: configuration file /etc/nginx/nginx.conf <span class="built_in">test</span> is successful</span><br></pre></td></tr></table></figure>

<h3 id="1-4-1-Nginx-의-설정-파일을-왜-확인하나요"><a href="#1-4-1-Nginx-의-설정-파일을-왜-확인하나요" class="headerlink" title="1.4.1. Nginx 의 설정 파일을 왜 확인하나요?"></a>1.4.1. Nginx 의 설정 파일을 왜 확인하나요?</h3><p>설정 파일에 오류가 있는 경우 Nginx를 시작하거나 재시작할 때 서버가 제대로 실행되지 않을 수 있기 때문에 <code>nginx -t</code> 명령어를 사용해서 사전에 문제를 확인합니다. 해당 명령어를 사용해서 설정 파일을 확인하고 수정한 후 문제가 없다면 Nginx를 안전하게 재시작하거나 로드할 수 있습니다.</p>
<h2 id="1-5-외부에서-접속했을-때-Nginx-에-연결이-되는지-확인"><a href="#1-5-외부에서-접속했을-때-Nginx-에-연결이-되는지-확인" class="headerlink" title="1.5. 외부에서 접속했을 때 Nginx 에 연결이 되는지 확인"></a>1.5. 외부에서 접속했을 때 Nginx 에 연결이 되는지 확인</h2><p><img src="/../image/welcome_to_nginx.png" alt="환영해주는 Nginx"></p>
<p>짜잔!</p>
<p>HTTP 포트인 80번으로 접속했더니 Nginx 에 연결이 됐습니다. 80번 포트는 생략이 가능합니다!<br><a target="_blank" rel="noopener" href="http://team-stance.com/">team-stance.com</a> 으로 접속을 했더니 Nginx 가 응답을 하고 있네요.</p>
<h1 id="2-Nginx-가-뭔데-저게-나와"><a href="#2-Nginx-가-뭔데-저게-나와" class="headerlink" title="2. Nginx 가 뭔데 저게 나와?"></a>2. Nginx 가 뭔데 저게 나와?</h1><p>80번 포트로 요청이 들어오면 Nginx 가 응답하도록 하는 설정을 한 적도 없는데 어떻게 Nginx 에서 요청을 수신하고 있는 걸까요?</p>
<p>Nginx 는 기본적으로 설치 됐을 때 80번 포트에서 요청을 수신하도록 설정되어 있습니다. Nginx 의 기본 설정 파일에 해당 내용이 포함되어 있기 때문에 따로 설정하지 않아도 Nginx가 HTTP의 기본 포트인 80번에서 자동으로 요청을 받게 돼요.</p>
<h2 id="2-1-Nginx-설정-파일-확인해-보기"><a href="#2-1-Nginx-설정-파일-확인해-보기" class="headerlink" title="2.1. Nginx 설정 파일 확인해 보기"></a>2.1. Nginx 설정 파일 확인해 보기</h2><p>Nginx 를 설치하면 <code>/etc/nginx/nginx.conf</code> 에 파일이 생성됩니다. 이곳에 80번 포트에 대한 설정이 포함되어 있어요. ec2 인스턴스의 루트 디렉터리로 이동을 한 후 해당 경로를 찾아가 아래의 명령어를 이용해 <code>nginx.conf</code> 파일을 열어봅시다.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim nginx.conf</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">    listen       80;</span><br><span class="line">    listen       [::]:80;</span><br><span class="line">    server_name  _;</span><br><span class="line">    root         /usr/share/nginx/html;</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Load configuration files for the default server block.</span></span><br><span class="line">    include /etc/nginx/default.d/*.conf;</span><br><span class="line"></span><br><span class="line">    error_page 404 /404.html;</span><br><span class="line">    location = /404.html &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    error_page 500 502 503 504 /50x.html;</span><br><span class="line">    location = /50x.html &#123;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>설정 파일을 확인해 보면 위와 같을 거예요. </p>
<ul>
<li><code>listen 80</code>: Nginx 가 80번 포트를 수신하도록 설정</li>
<li><code>root /usr/share/nginx/html</code> : 해당 디렉터리에 있는 정적 파일, index.html 을 응답</li>
</ul>
<p>80 포트로 요청했을 때 왜 “Welcome to nginx!” 페이지가 나왔는지 알게 되었습니다. 이제 HTTPS 를 적용 시켜보겠습니다.</p>
<h1 id="3-Let’s-Encrypt-에서-인증서-발급받기"><a href="#3-Let’s-Encrypt-에서-인증서-발급받기" class="headerlink" title="3. Let’s Encrypt 에서 인증서 발급받기"></a>3. Let’s Encrypt 에서 인증서 발급받기</h1><p>무료 SSL 인증서를 발급해주는 인증 기관인 Let’s Encrypt 를 통해서 인증서를 발급 받아보도록 하겠습니다.<br><a target="_blank" rel="noopener" href="https://letsencrypt.org/ko/getting-started/">Let’s Encrypt</a> 에서는 <a target="_blank" rel="noopener" href="https://certbot.eff.org/">Certbot</a> 이라는 클라이언트 도구를 사용하는 것을 추천해주고 있어서 Certbot을 설치하고 SSL 인증서를 발급 받도록 하겠습니다.</p>
<h2 id="3-1-Certbot-이-뭔데"><a href="#3-1-Certbot-이-뭔데" class="headerlink" title="3.1. Certbot 이 뭔데?"></a>3.1. Certbot 이 뭔데?</h2><p>Certbot 은 Let’s Encrypt 인증서를 자동으로 요청하고 설치하기 위해 설계된 클라이언트 도구입니다. Certbot 가 하는 일은 다음과 같아요.</p>
<h3 id="인증서-요청"><a href="#인증서-요청" class="headerlink" title="인증서 요청"></a>인증서 요청</h3><p>Certbot 은 Let’s Encrypt 에 요청을 보내서 도메인에 대한 SSL 인증서를 발급 받습니다.</p>
<h3 id="인증서-설치"><a href="#인증서-설치" class="headerlink" title="인증서 설치"></a>인증서 설치</h3><p>인증서가 발급된 후 Certbot 은 웹 서버(Nginx, Apache)에 인증서를 자동으로 설치합니다.</p>
<h3 id="갱신-자동화"><a href="#갱신-자동화" class="headerlink" title="갱신 자동화"></a>갱신 자동화</h3><p>Let’s Encrypt 인증서는 <strong>90일 동안 유효</strong>하기 때문에 90일마다 인증서를 갱신해야 하는데, Certbot 은 자동으로 인증서를 갱신하도록 설정할 수 있습니다.</p>
<h2 id="3-2-Certbot-직접-설치"><a href="#3-2-Certbot-직접-설치" class="headerlink" title="3.2. Certbot 직접 설치"></a>3.2. Certbot 직접 설치</h2><p><strong>⭐️ Amazon Linux 2023</strong> 을 기준으로 설명합니다! </p>
<ul>
<li>Amazon Linux 2023에서는 <code>snapd</code>가 기본적으로 지원되지 않기 때문에 다른 방법으로 Certbot을 설치해야 합니다.</li>
<li>Amazon Linux 2023에서는 epel-release 도 설치되지 않기 때문에 <strong>EPEL(Extra Packages for Enterprise Linux)</strong> 리포지터리를 설치하지 않고 Certbot 을 직접 설치해야 합니다.</li>
</ul>
<p>아래의 명령어로 Certbot 을 직접 다운로드해서 사용하겠습니다.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> dnf install -y augeas-libs</span><br><span class="line"><span class="built_in">sudo</span> python3 -m venv /opt/certbot/</span><br><span class="line"><span class="built_in">sudo</span> /opt/certbot/bin/pip install --upgrade pip</span><br><span class="line"><span class="built_in">sudo</span> /opt/certbot/bin/pip install certbot</span><br></pre></td></tr></table></figure>

<h2 id="3-3-Nginx-플러그인-설치"><a href="#3-3-Nginx-플러그인-설치" class="headerlink" title="3.3. Nginx 플러그인 설치"></a>3.3. Nginx 플러그인 설치</h2><p>Nginx 플러그인은 Certbot의 기능 중 하나로, Nginx 설정을 자동으로 업데이트하여 SSL 인증서를 쉽게 설치할 수 있도록 도와줍니다. </p>
<h3 id="3-3-1-필요한-패키지-설치"><a href="#3-3-1-필요한-패키지-설치" class="headerlink" title="3.3.1. 필요한 패키지 설치"></a>3.3.1. 필요한 패키지 설치</h3><p>Nginx 플러그인을 사용하기 위해서는 <code>python3-certbot-nginx</code> 패키지를 설치해야 합니다. 아래의 명령어로 패키지를 설치합니다.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> /opt/certbot/bin/pip install certbot-nginx</span><br></pre></td></tr></table></figure>

<h3 id="3-3-2-설치-확인"><a href="#3-3-2-설치-확인" class="headerlink" title="3.3.2. 설치 확인"></a>3.3.2. 설치 확인</h3><p>설치가 완료된 후 해당 명령어를 입력하면 Nginx 플러그인이 설치 되었는지 확인 할 수 있습니다. </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> /opt/certbot/bin/certbot plugins</span><br></pre></td></tr></table></figure>

<p>설치가 되었다면 아래와 같이 Nginx 플러그인이 목록에 나타납니다.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">Saving debug <span class="built_in">log</span> to /var/log/letsencrypt/letsencrypt.log</span><br><span class="line"></span><br><span class="line">- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -</span><br><span class="line">* nginx</span><br><span class="line">Description: Nginx Web Server plugin</span><br><span class="line">Interfaces: Authenticator, Installer, Plugin</span><br><span class="line">Entry point: EntryPoint(name=<span class="string">&#x27;nginx&#x27;</span>,</span><br><span class="line">value=<span class="string">&#x27;certbot_nginx._internal.configurator:NginxConfigurator&#x27;</span>,</span><br><span class="line">group=<span class="string">&#x27;certbot.plugins&#x27;</span>)</span><br><span class="line"></span><br><span class="line">* standalone</span><br><span class="line">Description: Runs an HTTP server locally <span class="built_in">which</span> serves the necessary validation</span><br><span class="line">files under the /.well-known/acme-challenge/ request path. Suitable <span class="keyword">if</span> there is</span><br><span class="line">no HTTP server already running. HTTP challenge only (wildcards not supported).</span><br><span class="line">Interfaces: Authenticator, Plugin</span><br><span class="line">Entry point: EntryPoint(name=<span class="string">&#x27;standalone&#x27;</span>,</span><br><span class="line">value=<span class="string">&#x27;certbot._internal.plugins.standalone:Authenticator&#x27;</span>,</span><br><span class="line">group=<span class="string">&#x27;certbot.plugins&#x27;</span>)</span><br><span class="line"></span><br><span class="line">* webroot</span><br><span class="line">Description: Saves the necessary validation files to a</span><br><span class="line">.well-known/acme-challenge/ directory within the nominated webroot path. A</span><br><span class="line">seperate HTTP server must be running and serving files from the webroot path.</span><br><span class="line">HTTP challenge only (wildcards not supported).</span><br><span class="line">Interfaces: Authenticator, Plugin</span><br><span class="line">Entry point: EntryPoint(name=<span class="string">&#x27;webroot&#x27;</span>,</span><br><span class="line">value=<span class="string">&#x27;certbot._internal.plugins.webroot:Authenticator&#x27;</span>,</span><br><span class="line">group=<span class="string">&#x27;certbot.plugins&#x27;</span>)</span><br><span class="line">- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -</span><br></pre></td></tr></table></figure>

<h2 id="3-4-Let’s-Encrypt-인증서-발급-받기"><a href="#3-4-Let’s-Encrypt-인증서-발급-받기" class="headerlink" title="3.4. Let’s Encrypt 인증서 발급 받기"></a>3.4. Let’s Encrypt 인증서 발급 받기</h2><p>아래 명령어를 실행하여 SSL 인증서를 발급 받아 봅시다.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> /opt/certbot/bin/certbot --nginx</span><br></pre></td></tr></table></figure>

<p>이메일 주소를 입력하구요.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Enter email address (used <span class="keyword">for</span> urgent renewal and security notices)</span><br><span class="line"> (Enter <span class="string">&#x27;c&#x27;</span> to cancel):</span><br></pre></td></tr></table></figure>

<p>Let’s Encrypt 서비스 계약 조건에 동의도 합니다.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Please <span class="built_in">read</span> the Terms of Service at</span><br><span class="line">https://letsencrypt.org/documents/LE-SA-v1.4-April-3-2024.pdf. You must agree <span class="keyword">in</span></span><br><span class="line">order to register with the ACME server. Do you agree?</span><br></pre></td></tr></table></figure>

<p>Certbot 이  Let’s Encrypt 프로젝트와 관련된 전자 프런티어 재단(EFF)에 이메일 주소를 공유할 것인지에 대한 질문인데요. 동의 혹은 거부를 하고 넘어갑니다.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Would you be willing, once your first certificate is successfully issued, to</span><br><span class="line">share your email address with the Electronic Frontier Foundation, a founding</span><br><span class="line">partner of the Let<span class="string">&#x27;s Encrypt project and the non-profit organization that</span></span><br><span class="line"><span class="string">develops Certbot? We&#x27;</span>d like to send you email about our work encrypting the web,</span><br><span class="line">EFF news, campaigns, and ways to support digital freedom.</span><br></pre></td></tr></table></figure>

<p>Let’s Encrypt SSL 인증서를 발급받기 위해서는 다음 두 가지 도메인을 모두 입력해야 합니다:</p>
<ol>
<li><code>team-stance.com</code> (루트 도메인)</li>
<li><code>www.team-stance.com</code> (서브 도메인)</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Please enter the domain name(s) you would like on your certificate (comma and/or</span><br><span class="line">space separated) (Enter <span class="string">&#x27;c&#x27;</span> to cancel): team-stance.com,www.team-stance.com</span><br></pre></td></tr></table></figure>

<p>여기까지 아무 문제없이 잘 오셨다면 인증서 발급이 무사히 완료될 거예요. 인증서가 발급되면 Certbot 이 443 에 대한 요청을 8080 으로 전달하는 Nginx 의 설정을 자동으로 해주기 때문에 별도로 설정 파일을 수정할 필요는 없습니다.</p>
<p>👇🏻 혹시나 실패 하셨다면 아래의 글을 참조해주세요.  </p>
<details>
  <summary><span style="font-size: 1.25em; font-weight: bold;">3.4.1. [실패] A 레코드를 찾을 수 없습니다</span></summary>

<p>  💡 성공하신 분은 해당 챕터는 스킵하시면 됩니다.</p>
<p><img src="/../image/not_found_a_record.png" alt="찾을 수 없습니다..."></p>
<p>Let’s Encrypt가 도메인 <a target="_blank" rel="noopener" href="http://team-stance.com/">team-stance.com</a> 에 대한 A 레코드를 찾을 수 없다는 의미입니다. DNS 레코드를 확인해 볼까요?</p>
<h3 id="A-레코드-추가하기"><a href="#A-레코드-추가하기" class="headerlink" title="A 레코드 추가하기"></a>A 레코드 추가하기</h3><p>저는 가비아에서 도메인을 구매했기 때문에 가비아의 DNS 관리 패널에 접속해서 확인해보겠습니다. </p>
<p>호스트가 www 인 A 레코드가 하나밖에 없어서 아래와 같이 A 레코드를 추가해주었습니다.  값&#x2F;위치 에는 인스턴스의 ip를 입력하시면 됩니다.</p>
<p><img src="/../image/%EA%B0%80%EB%B9%84%EC%95%84_DNS_%EA%B4%80%EB%A6%AC_%ED%8C%A8%EB%84%90.png" alt="가비아 DNS 관리 패널"></p>
<h3 id="DNS-전파-상태-확인"><a href="#DNS-전파-상태-확인" class="headerlink" title="DNS 전파 상태 확인"></a>DNS 전파 상태 확인</h3><p>레코드를 추가한 후 DNS 전파 상태를 확인하기 위해 <a target="_blank" rel="noopener" href="https://www.whatsmydns.net/">WhatsMyDNS</a> 에 접속해 확인해보겠습니다.</p>
<p><img src="/../image/DNS_%EC%A0%84%ED%8C%8C_%EC%83%81%ED%83%9C_%ED%99%95%EC%9D%B8.png" alt="전파되고 있는 스탠스"></p>
<p>잘 나오는 것을 확인했으니 다시 SSL 인증서를 발급 받아 봅니다.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> /opt/certbot/bin/certbot --nginx</span><br></pre></td></tr></table></figure>

</details>

<details>
  <summary><span style="font-size: 1.25em; font-weight: bold;">3.4.2. [실패] 인증서는 성공적으로 발급 그러나 Nginx 에는…</span></summary>

<p>  <img src="/../image/%EC%9D%B8%EC%A6%9D%EC%84%9C_%EB%B0%9C%EA%B8%89_%EC%84%B1%EA%B3%B5_nginx%EC%97%90%EB%8A%94_%EC%8B%A4%ED%8C%A8.png" alt="또 에러메세지"></p>
<p>인증서는 성공적으로 발급되었지만… Nginx 에는 자동으로 설치가 되지 않았다는 의미입니다.  Nginx 설정 파일을 확인해 봐야 합니다.</p>
<h3 id="Nginx-설정-파일-수정하기"><a href="#Nginx-설정-파일-수정하기" class="headerlink" title="Nginx 설정 파일 수정하기"></a>Nginx 설정 파일 수정하기</h3><p>Nginx 설정 파일은 루트 디렉터리를 기준으로 일반적으로 <code>/etc/nginx/nginx.conf</code> 또는 <code>/etc/nginx/conf.d/</code> 디렉터리 내의 파일에 있습니다. 아래의 선택1과 2 중에 택하시면 됩니다.</p>
<h3 id="선택1-nginx-conf-파일-수정"><a href="#선택1-nginx-conf-파일-수정" class="headerlink" title="선택1. nginx.conf 파일 수정"></a>선택1. nginx.conf 파일 수정</h3><p>이 파일은 Nginx 의 기본 설정을 포함하고 있기 때문에 파일을 수정하면서 잘못된 설정을 할 경우 Nginx 가 제대로 작동하지 않을 가능성이 있습니다.</p>
<h3 id="선택2-conf-d-디렉터리-사용"><a href="#선택2-conf-d-디렉터리-사용" class="headerlink" title="선택2. conf.d 디렉터리 사용"></a>선택2. conf.d 디렉터리 사용</h3><p>conf.d 디렉터리 내부에 새로운 .conf 파일을 생성해서 관리하면 Nginx 의 기본 설정과 분리할 수 있습니다. 그렇기 때문에 저는 해당 디렉터리에 <code>team-stance.com.conf</code> 파일을 생성해서 사용했습니다.</p>
<p>아래의 명령어를 입력하여 설정 파일을 추가해 봅시다.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> vim /etc/nginx/conf.d/team-stance.com.conf</span><br></pre></td></tr></table></figure>

<p>서버 블록을 추가합니다. 해당 설정을 추가하면 HTTPS 요청에 대한 처리를 할 수 있습니다.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">    listen 443 ssl;</span><br><span class="line">    server_name team-stance.com www.team-stance.com;</span><br><span class="line"></span><br><span class="line">    ssl_certificate /etc/letsencrypt/sample.pem         <span class="comment"># Let&#x27;s Encrypt 인증서 경로를 적어주세요.</span></span><br><span class="line">    ssl_certificate_key /etc/letsencrypt/sampleKey.pem  <span class="comment"># 비공개 키 경로를 적어주세요.</span></span><br><span class="line"></span><br><span class="line">    location / &#123;</span><br><span class="line">        proxy_pass http://localhost:8080;</span><br><span class="line">        proxy_set_header Host <span class="variable">$host</span>;</span><br><span class="line">        proxy_set_header X-Real-IP <span class="variable">$remote_addr</span>;</span><br><span class="line">        proxy_set_header X-Forwarded-For <span class="variable">$proxy_add_x_forwarded_for</span>;</span><br><span class="line">        proxy_set_header X-Forwarded-Proto <span class="variable">$scheme</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="파일-저장-및-Nginx-재시작"><a href="#파일-저장-및-Nginx-재시작" class="headerlink" title="파일 저장 및 Nginx 재시작"></a>파일 저장 및 Nginx 재시작</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> systemctl restart nginx</span><br></pre></td></tr></table></figure>

</details>

<h1 id="4-HTTPS-설정-확인"><a href="#4-HTTPS-설정-확인" class="headerlink" title="4. HTTPS 설정 확인"></a>4. HTTPS 설정 확인</h1><p><img src="/../image/team_stance_com.png" alt="https://team-stance.com"></p>
<p><img src="/../image/www_team_stance_com.png" alt="https://www.team-stance.com"></p>
<p>흑 😭 드디어 성공입니다. 인증서가 발급되고 Nginx 설정이 완료되면 Certbot 은 자동으로 Nginx 를 재시작 합니다. 브라우저에서 <code>https://team-stance.com</code> 와<code>https://www.team-stance.com</code> 으로 접속해 보면 SSL이 적용된 것을 확인 할 수 있습니다!</p>
<h1 id="5-SSL-인증서-갱신-자동화"><a href="#5-SSL-인증서-갱신-자동화" class="headerlink" title="5. SSL 인증서 갱신 자동화"></a>5. SSL 인증서 갱신 자동화</h1><p>Let’s Encrypt 인증서를 90일마다 갱신 해줘야 하기 때문에 Certbot 을 사용해서 자동으로 갱신하도록 설정해보겠습니다.</p>
<h2 id="5-1-SSL-인증서-갱신-프로세스-시뮬레이션-하기"><a href="#5-1-SSL-인증서-갱신-프로세스-시뮬레이션-하기" class="headerlink" title="5.1. SSL 인증서 갱신 프로세스 시뮬레이션 하기"></a>5.1. SSL 인증서 갱신 프로세스 시뮬레이션 하기</h2><p>먼저 인증서를 갱신하기 전에 모든 것이 제대로 작동하는지 테스트 하기 위해 아래의 명령어로 시뮬레이션을 실행합니다. </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> /opt/certbot/bin/certbot renew --dry-run</span><br></pre></td></tr></table></figure>

<p>시뮬레이션을 성공적으로 마치면 아래와 같은 내용을 확인할 수 있어요!</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Simulating renewal of an existing certificate <span class="keyword">for</span> team-stance.com and www.team-stance.com</span><br><span class="line"></span><br><span class="line">- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -</span><br><span class="line">Congratulations, all simulated renewals succeeded:</span><br><span class="line">  /etc/letsencrypt/sample.pem  (success)</span><br><span class="line">- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -</span><br></pre></td></tr></table></figure>

<h2 id="5-2-인증서-자동-갱신-코드-추가하기"><a href="#5-2-인증서-자동-갱신-코드-추가하기" class="headerlink" title="5.2. 인증서 자동 갱신 코드 추가하기"></a>5.2. 인증서 자동 갱신 코드 추가하기</h2><h3 id="5-2-1-혹시-crontab-명령어가-설치-되어-있지-않으시다면"><a href="#5-2-1-혹시-crontab-명령어가-설치-되어-있지-않으시다면" class="headerlink" title="5.2.1. 혹시 crontab 명령어가 설치 되어 있지 않으시다면?"></a>5.2.1. 혹시 crontab 명령어가 설치 되어 있지 않으시다면?</h3><p>네… 이런 오류가 발생하게 됩니다.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span>: crontab: <span class="built_in">command</span> not found</span><br></pre></td></tr></table></figure>

<p><code>crontab</code> 명령어가 설치되어 있는지부터 확인해봐야겠죠? 아래의 명령어를 입력하여 경로가 반환되는지 확인합니다. 경로가 반환되지 않는다면 우선 crontab 부터 설치해야 해요.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">which</span> crontab</span><br></pre></td></tr></table></figure>

<h3 id="crontab-설치-후-활성화"><a href="#crontab-설치-후-활성화" class="headerlink" title="crontab 설치 후 활성화"></a>crontab 설치 후 활성화</h3><p>아래의 명령어로 cronie 패키지를 설치하면 crontab 을 사용할 수 있습니다. </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> dnf install cronie</span><br></pre></td></tr></table></figure>

<p>패키지를 설치한 후 cron 서비스를 시작하는 명령어를 입력합니다. </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> systemctl start crond</span><br><span class="line"><span class="built_in">sudo</span> systemctl <span class="built_in">enable</span> crond</span><br></pre></td></tr></table></figure>

<p>아래의 명령어를 사용해서 Crontab 에 코드를 추가합니다.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> crontab -e</span><br></pre></td></tr></table></figure>

<p>crontab 편집기에 크론 작업을 추가합니다. 저는 인증서를 매주 금요일 0시 0분에 갱신하도록 설정했어요.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">0 0 * * 5 /opt/certbot/bin/certbot renew --quiet</span><br></pre></td></tr></table></figure>

<h2 id="5-3-크론-작업-목록-확인"><a href="#5-3-크론-작업-목록-확인" class="headerlink" title="5.3. 크론 작업 목록 확인"></a>5.3. 크론 작업 목록 확인</h2><p>다음 명령어를 사용해서 crontab 에 추가한 작업이 제대로 등록 되었는지 확인합니다. </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> crontab -l</span><br></pre></td></tr></table></figure>

<h1 id="마무리하며"><a href="#마무리하며" class="headerlink" title="마무리하며"></a>마무리하며</h1><p>포트포워딩 하는 과정에서 안되는 게 많아서 너무 어렵게 느껴졌습니다. 계속 에러는 나고 이건 또 무슨 에러인지 알아보고 하나씩 해결해 나가는 과정을 겪으면서 왜 Nginx 가 필요한지 그래서 Nginx 에서 어떤 일이 일어나는지 이해할 수 있었어요. </p>
<p>클라이언트의 요청이 들어오면 Nginx 가 이 요청을 수신해 8080 으로 전달해준다는 큰 흐름을 머릿속에 넣고나니 어떤 걸 먼저 해야하는지 헷갈리지 않게 됐어요. 포트포워딩이 한 번에 되지 않고 여러 어려움을 겪은 덕에 머릿속에 개념이 더 확실히 잡혔습니다. 오히려 좋아!</p>
<p>저와 같은 에러를 겪고 계신 분들에게 이 글이 도움이 되었으면 좋겠습니다.</p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-9 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Posted&nbsp;2024-09-11</span><span class="level-item">Updated&nbsp;<time dateTime="2024-09-11T08:57:20.000Z" title="9/11/2024, 5:57:20 PM">2024-09-11</time></span><span class="level-item"><a class="link-muted" href="/categories/%EC%86%8C%ED%94%84%ED%8A%B8%EC%9B%A8%EC%96%B4-%EC%95%84%ED%82%A4%ED%85%8D%EC%B2%98/">소프트웨어 아키텍처</a></span><span class="level-item">22 minutes read (About 3245 words)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2024/09/11/OpenAPI-Generator%EB%A1%9C-%ED%8E%98%EC%9D%B4%EC%A7%95-%EC%B2%98%EB%A6%AC%EB%8A%94-%EC%96%B4%EB%96%BB%EA%B2%8C-%ED%95%B4/">OpenAPI Generator로 페이징 처리는 어떻게 해? (with Spring)</a></p><div class="content"><h1 id="들어가며"><a href="#들어가며" class="headerlink" title="들어가며"></a>들어가며</h1><p>안녕하세요! 이번 글은 스프링에서 OpenAPI Generator 로 페이징 처리 하는 과정에 대해서 공유하려고 합니다.</p>
<p>이번에도 제가 만들고 있는 서비스를 먼저 소개해야겠죠? 저는 농구 동호회의 어드민 페이지를 만들고 있어요. 해당 서비스에서 필요한 기능은 크게 두 가지 입니다.</p>
<ul>
<li>재무 관리</li>
<li>회원 관리</li>
</ul>
<p>재무 관리 기능은 동호회 모임 통장과 관련한 기능인데요. 가계부 어플을 생각하면 이해하기 쉬울 거예요. 동호회 운영과 관련한 모든 재정적인 활동 내역을 기록하고 조회할 수 있는 기능입니다. 이 글에서는 재무 관리 기능에 대해서만 다룰 거예요.</p>
<p>모임 통장의 모든 입출금 내역을 조회하는 API 가 있습니다. 입출금 내역은 시간이 갈수록 쌓이기 때문에 데이터가 굉장히 많은데요. 그래서 해당 API 를 페이징 처리 하려고 합니다. 그런데 OpenAPI Generator 로는 어떻게 페이징 처리를 해야할까요?</p>
<h1 id="페이징-처리를-하고-싶어"><a href="#페이징-처리를-하고-싶어" class="headerlink" title="페이징 처리를 하고 싶어"></a>페이징 처리를 하고 싶어</h1><p>Controller 계층에서 메서드를 직접 정의하는 경우에는 일반적으로 아래와 같이 처리해요. 파라미터의 <code>Pageable</code> 객체가 보이시나요? Pageable 을 이용해서 페이지네이션 처리를 하게 됩니다.</p>
<p>해당 API 로 요청을 해볼까요? <code>/transactions?page=0&amp;size=10</code> 로 요청을 하면 첫 페이지의 데이터 10개를 반환합니다.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequiredArgsConstructor</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/transactions&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TransactionController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> TransactionService transactionService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping</span></span><br><span class="line">    <span class="keyword">public</span> Page&lt;Transaction&gt; <span class="title function_">getTransactions</span><span class="params">(<span class="meta">@PageableDefault(size = 10)</span> Pageable pageable)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> transactionService.getTransactions(pageable);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h1 id="OpenAPI-Generator로는-어떻게-해"><a href="#OpenAPI-Generator로는-어떻게-해" class="headerlink" title="OpenAPI Generator로는 어떻게 해?"></a>OpenAPI Generator로는 어떻게 해?</h1><p>OpenAPI Generator는 <code>openapi.yaml</code> 파일에 정의된 스펙을 읽고 코드를 만들어줍니다. 그렇기 때문에 OpenAPI 스펙에서 페이지네이션을 정의하는 방식을 사용해야 해요.</p>
<h2 id="방법-1-API에-정의된-클래스-대신-Spring-클래스를-사용하도록-만들기"><a href="#방법-1-API에-정의된-클래스-대신-Spring-클래스를-사용하도록-만들기" class="headerlink" title="방법 1: API에 정의된 클래스 대신 Spring 클래스를 사용하도록 만들기"></a>방법 1: API에 정의된 클래스 대신 Spring 클래스를 사용하도록 만들기</h2><p>우선 OpenAPI에 스펙을 정의해야 해요. 파라미터의 스키마를 정의하는 곳에 Pageable 객체를 참조하도록 작성합니다. 하지만 우리가 정의해놓은 Pageable 객체를 사용하진 않을 거예요. Spring에서 제공하는 Pageable 객체를 사용하게 할 건데요.</p>
<h3 id="1-openapi-yaml-에-스펙-정의하기"><a href="#1-openapi-yaml-에-스펙-정의하기" class="headerlink" title="1. openapi.yaml 에 스펙 정의하기"></a>1. openapi.yaml 에 스펙 정의하기</h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">paths:</span></span><br><span class="line">  <span class="string">/transactions:</span></span><br><span class="line">    <span class="attr">get:</span></span><br><span class="line">      <span class="attr">parameters:</span></span><br><span class="line">       <span class="bullet">-</span> <span class="attr">in:</span> <span class="string">query</span></span><br><span class="line">          <span class="attr">name:</span> <span class="string">pageable</span></span><br><span class="line">          <span class="attr">required:</span> <span class="literal">false</span></span><br><span class="line">          <span class="attr">schema:</span></span><br><span class="line">            <span class="string">$ref:</span> <span class="string">&#x27;#/components/schemas/Pageable&#x27;</span></span><br><span class="line"><span class="attr">components:</span></span><br><span class="line">  <span class="attr">schemas:</span></span><br><span class="line">      <span class="attr">Pageable:</span></span><br><span class="line">      <span class="attr">description:</span> <span class="string">minimal</span> <span class="string">Pageable</span> <span class="string">query</span> <span class="string">parameters</span></span><br><span class="line">      <span class="attr">type:</span> <span class="string">object</span></span><br><span class="line">      <span class="attr">properties:</span></span><br><span class="line">        <span class="attr">page:</span></span><br><span class="line">          <span class="attr">type:</span> <span class="string">integer</span></span><br><span class="line">        <span class="attr">size:</span></span><br><span class="line">          <span class="attr">type:</span> <span class="string">integer</span></span><br></pre></td></tr></table></figure>

<h3 id="2-build-gradle-에-매핑-추가하기"><a href="#2-build-gradle-에-매핑-추가하기" class="headerlink" title="2. build.gradle 에 매핑 추가하기"></a>2. build.gradle 에 매핑 추가하기</h3><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">openApiGenerate &#123;</span><br><span class="line">    ...</span><br><span class="line">    importMappings = [</span><br><span class="line">            <span class="string">&#x27;Pageable&#x27;</span>: <span class="string">&#x27;org.springframework.data.domain.Pageable&#x27;</span></span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>gradle 파일에 해당 코드를 추가해주면 API에 정의된 Pageable 클래스 대신 Spring의 Pageable 객체를  import 해올 거예요.</p>
<h3 id="OpenAPI를-구현한-controller-계층"><a href="#OpenAPI를-구현한-controller-계층" class="headerlink" title="OpenAPI를 구현한 controller 계층"></a>OpenAPI를 구현한 controller 계층</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequiredArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TransactionController</span> <span class="keyword">implements</span> <span class="title class_">TransactionApi</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> ResponseEntity&lt;List&lt;TransactionResponse&gt;&gt; <span class="title function_">getAllTransactions</span><span class="params">(Pageable pageable)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="문제점"><a href="#문제점" class="headerlink" title="문제점"></a>문제점</h3><p>우리가 정의해놓은 Pageable 객체가 아닌 Spring의 Pageable 객체를 사용하기 위해서는 어쨌든 openapi.yaml 파일에 Pageable 객체를 작성해야 한다는 점입니다. OpenAPI 생성기가 사용하지도 않을 클래스를 생성해야 한다는 것이죠.</p>
<h2 id="방법-2-OpenAPI-Generator가-지원하는-확장-플래그-사용하기"><a href="#방법-2-OpenAPI-Generator가-지원하는-확장-플래그-사용하기" class="headerlink" title="방법 2: OpenAPI Generator가 지원하는 확장 플래그 사용하기"></a>방법 2: OpenAPI Generator가 지원하는 확장 플래그 사용하기</h2><p><a target="_blank" rel="noopener" href="https://openapi-generator.tech/docs/generators/spring/">OpenAPI Generator 공식문서</a> 를 확인해보면 스프링에서 사용할 수 있는 <strong>VENDOR EXTENSIONS</strong> 를 확인해볼 수 있어요. 페이징처리와 관련 있는 확장 플래그는 아래와 같아요.</p>
<p>Default Value 가 false로 설정이 되어있는데 이걸 true로 설정해주면 되는 거죠.</p>
<p><img src="/../image/openapi_generator_vendor_extensios.png" alt="SUPPORTED VENDOR EXTENSIONS"></p>
<h3 id="1-openapi-yaml-에-확장-플래그-추가하기"><a href="#1-openapi-yaml-에-확장-플래그-추가하기" class="headerlink" title="1. openapi.yaml 에 확장 플래그 추가하기"></a>1. openapi.yaml 에 확장 플래그 추가하기</h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">paths:</span></span><br><span class="line">  <span class="string">/transactions:</span></span><br><span class="line">    <span class="attr">get:</span></span><br><span class="line">      <span class="attr">tags:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">transaction</span></span><br><span class="line">      <span class="attr">summary:</span> <span class="string">입출금</span> <span class="string">내역을</span> <span class="string">조회합니다.</span></span><br><span class="line">      <span class="attr">operationId:</span> <span class="string">getAllTransactions</span></span><br><span class="line">      <span class="attr">x-spring-paginated:</span> <span class="literal">true</span></span><br></pre></td></tr></table></figure>

<h3 id="2-build-gradle-에-springdoc-openapi-의존성-추가하기"><a href="#2-build-gradle-에-springdoc-openapi-의존성-추가하기" class="headerlink" title="2. build.gradle 에 springdoc-openapi 의존성 추가하기"></a>2. build.gradle 에 <code>springdoc-openapi</code> 의존성 추가하기</h3><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">dependencies &#123;</span><br><span class="line">    <span class="comment">// springdoc-openapi</span></span><br><span class="line">    implementation <span class="string">&#x27;org.springdoc:springdoc-openapi-ui:1.8.0&#x27;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>build.gradle 파일에 <code>springdoc-openapi</code> 관련 의존성을 추가해야 해요. 최신 버전을 사용 중인지도 확인해야 합니다.</p>
<h3 id="springdoc-openapi-가-왜-필요할까"><a href="#springdoc-openapi-가-왜-필요할까" class="headerlink" title="springdoc-openapi 가 왜 필요할까?"></a><code>springdoc-openapi</code> 가 왜 필요할까?</h3><p>springdoc-openapi 는 Spring 애플리케이션에서 OpenAPI와 관련된 기능을 처리하는 라이브러리예요. 해당 의존성을 추가하는 이유는 OpenAPI와 Spring 간의 통합을 처리하기 위해서입니다. <code>Pageable</code> 같은 Spring의 복잡한 객체를 OpenAPI 스펙으로 변환하고 이를 적절히 문서화하기 위해 필요해요.</p>
<ul>
<li><strong><code>x-spring-paginated: true</code></strong><ul>
<li>OpenAPI Generator가 자동으로 <code>Pageable</code> 객체를 생성하는 역할을 합니다.</li>
</ul>
</li>
<li>ParameterObject 애노테이션<ul>
<li><p>OpenAPI 생성기가 자동 생성해준 인터페이스를 열어봅시다. 아래와 같은 @ParameterObject 애노테이션을 확인해볼 수 있어요.</p>
  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">TransactionApi</span> &#123;</span><br><span class="line">      </span><br><span class="line">    ResponseEntity&lt;List&lt;TransactionResponse&gt;&gt; <span class="title function_">getAllTransactions</span><span class="params">(</span></span><br><span class="line"><span class="params">            <span class="meta">@ParameterObject</span> <span class="keyword">final</span> Pageable pageable</span></span><br><span class="line"><span class="params">    )</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>OpenAPI에서 <code>Pageable</code> 과 같은 복잡한 객체를 처리하려면 <code>@ParameterObject</code> 애노테이션을 사용하여 해당 객체를 명확하게 정의해줘야 합니다. <code>@ParameterObject</code> 애노테이션은 <code>springdoc-openapi</code> 라이브러리에서 제공하고 있고, 해당 라이브러리를 추가하지 않으면 파라미터 매핑에 실패하게 돼요.</p>
</li>
</ul>
</li>
</ul>
<h3 id="문제점-1"><a href="#문제점-1" class="headerlink" title="문제점"></a>문제점</h3><p><code>springdoc-openapi</code> 의존성을 추가해야 <code>Pageable</code> 같은 복잡한 객체를 처리할 수 있다는 것입니다.</p>
<ul>
<li>프로젝트 복잡성 증가<ul>
<li>페이징 처리와 관련하여 추가적으로 의존성을 관리해야 합니다.</li>
<li>라이브러리 버전 호환성 문제를 발생시킬 가능성이 높습니다.</li>
</ul>
</li>
<li>빌드 시간 증가<ul>
<li>의존성이 추가될 수록 빌드 시간이 늘어나고, 전체 프로젝트의 크기가 증가될 수 있습니다.</li>
</ul>
</li>
<li>외부 라이브러리에 대한 의존성<ul>
<li>라이브러리의 업데이트 상황에 따라 문제가 발생할 수 있으므로 프로젝트가 외부 라이브러리에 의존하게 됩니다.</li>
</ul>
</li>
</ul>
<h2 id="방법-3-Pageable-관련-파라미터-직접-정의하기"><a href="#방법-3-Pageable-관련-파라미터-직접-정의하기" class="headerlink" title="방법 3: Pageable 관련 파라미터 직접 정의하기"></a>방법 3: Pageable 관련 파라미터 직접 정의하기</h2><p>OpenAPI 스펙에서 <code>page</code> ,<code>siz</code> 파라미터를 직접 정의하고 컨트롤러 계층에서 수동으로 <code>Pageable</code> 객체를 생성하는 방법입니다. 이 방식을 사용하면 <code>springdoc-openapi</code> 라이브러리에 의존하지 않으면서 페이징 기능을 사용할 수 있어요!</p>
<h3 id="1-openapi-yaml-에-파라미터-정의하기"><a href="#1-openapi-yaml-에-파라미터-정의하기" class="headerlink" title="1. openapi.yaml 에 파라미터 정의하기"></a>1. openapi.yaml 에 파라미터 정의하기</h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">paths:</span></span><br><span class="line">  <span class="string">/transactions:</span></span><br><span class="line">    <span class="attr">get:</span></span><br><span class="line">      <span class="attr">parameters:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">in:</span> <span class="string">query</span></span><br><span class="line">          <span class="attr">name:</span> <span class="string">page</span></span><br><span class="line">          <span class="attr">schema:</span></span><br><span class="line">            <span class="attr">type:</span> <span class="string">integer</span></span><br><span class="line">            <span class="attr">default:</span> <span class="number">1</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">in:</span> <span class="string">query</span></span><br><span class="line">          <span class="attr">name:</span> <span class="string">size</span></span><br><span class="line">          <span class="attr">schema:</span></span><br><span class="line">            <span class="attr">type:</span> <span class="string">integer</span></span><br><span class="line">            <span class="attr">default:</span> <span class="number">10</span></span><br><span class="line">      <span class="attr">responses:</span></span><br><span class="line">        <span class="attr">&#x27;200&#x27;:</span></span><br><span class="line">          <span class="attr">description:</span> <span class="string">A</span> <span class="string">paged</span> <span class="string">list</span> <span class="string">of</span> <span class="string">transactions</span></span><br><span class="line">          <span class="attr">content:</span></span><br><span class="line">            <span class="attr">application/json:</span></span><br><span class="line">              <span class="attr">schema:</span></span><br><span class="line">                <span class="attr">type:</span> <span class="string">array</span></span><br><span class="line">                <span class="attr">items:</span></span><br><span class="line">                  <span class="string">$ref:</span> <span class="string">&#x27;#/components/schemas/TransactionResponse&#x27;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="2-컨트롤러-계층에서-페이지네이션-처리하기"><a href="#2-컨트롤러-계층에서-페이지네이션-처리하기" class="headerlink" title="2. 컨트롤러 계층에서 페이지네이션 처리하기"></a>2. 컨트롤러 계층에서 페이지네이션 처리하기</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequiredArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TransactionController</span> <span class="keyword">implements</span> <span class="title class_">TransactionApi</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> ResponseEntity&lt;List&lt;TransactionResponse&gt;&gt; <span class="title function_">getAllTransactions</span><span class="params">(Integer page, Integer size)</span> &#123;</span><br><span class="line">        <span class="type">PageRequest</span> <span class="variable">pageable</span> <span class="operator">=</span> PageRequest.of(page, size);</span><br><span class="line">        System.out.println(<span class="string">&quot;pageable = &quot;</span> + pageable);</span><br><span class="line">    </span><br><span class="line">        <span class="keyword">return</span> ResponseEntity.ok(<span class="literal">null</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>page, size 파라미터를 전달하지 않고 API 요청을 하면 결과는 아래와 같습니다.<ul>
<li><code>http://localhost:8080/transactions</code></li>
<li>pageable &#x3D; Page request [number: 1, size 10, sort: UNSORTED]</li>
</ul>
</li>
<li>page와 size 파라미터를 전달하여 API 요청을 해보겠습니다.<ul>
<li><code>http://localhost:8080/transactions?page=2&amp;size=10</code></li>
<li>pageable &#x3D; Page request [number: 2, size 10, sort: UNSORTED]</li>
</ul>
</li>
</ul>
<h3 id="문제점-2"><a href="#문제점-2" class="headerlink" title="문제점"></a>문제점</h3><ul>
<li>컨트롤러 계층에서 Page 객체를 직접 생성해줘야 합니다.</li>
<li>page와 size 파라미터에 대한 유효성 검사를 별도로 해야 한다는 점입니다.<br>예를 들면 page와 size 값이 음수일 경우에 대한 처리가 필요해요. 이런 페이지네이션 파라미터에 대한 유효성 검사는 코드에서 별도로 처리해야 해요.</li>
</ul>
<h1 id="응답에-페이지네이션-정보가-없는데"><a href="#응답에-페이지네이션-정보가-없는데" class="headerlink" title="응답에 페이지네이션 정보가 없는데?"></a>응답에 페이지네이션 정보가 없는데?</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequiredArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TransactionController</span> <span class="keyword">implements</span> <span class="title class_">TransactionApi</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> ResponseEntity&lt;List&lt;TransactionResponse&gt;&gt; <span class="title function_">getAllTransactions</span><span class="params">(...)</span> &#123;</span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">        <span class="keyword">return</span> ResponseEntity.ok(<span class="literal">null</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>위에서 제시한 세 가지 방법 중 어떤 방법을 쓰더라도 OpenAPI Generator 가 생성해주는 응답값은 위 코드와 같습니다. <code>List&lt;TransactionResponse&gt;</code> List 타입을 반환해주죠.</p>
<p><strong>OpenAPI 에서는 <code>Page</code> 객체를 직접적으로 처리하거나 반환하는 것이 불가능해요.</strong> 원하는 데이터를 페이징 처리해서 들고와도 컨트롤러는 여전히 List만 반환해줄 뿐입니다… 😭</p>
<p>이 문제를 해결하기 위한 방법은 페이징 관련 정보를 별도로 제공해주는 것입니다! 컨텐츠와 페이징 메타데이터를 포함하는 응답 객체를 만들어서 클라이언트에 전달해주는 방법을 사용해볼 거예요.</p>
<h2 id="1-페이징-메타데이터-구성하기"><a href="#1-페이징-메타데이터-구성하기" class="headerlink" title="1. 페이징 메타데이터 구성하기"></a>1. 페이징 메타데이터 구성하기</h2><p>아래 그림은 <code>/transactions</code> API 를 호출했을 때 보여주고 싶은 화면이에요. 여기에 페이징 처리를 해볼 건데요. 클라이언트에 어떤 페이징 정보를 전달해야할까요? 클라이언트는 전달받은 페이징 정보를 기반으로 페이징 UI를 구성합니다.</p>
<p><img src="/../image/all_account_transactions.png" alt="모임통장 전체 내역"></p>
<h3 id="1-pageNumber-현재-페이지-번호"><a href="#1-pageNumber-현재-페이지-번호" class="headerlink" title="1. pageNumber (현재 페이지 번호)"></a>1. <code>pageNumber</code> (현재 페이지 번호)</h3><ul>
<li>현재 보고 있는 페이지가 몇 번째인지 명확히 알려줄 수 있어요.</li>
<li>예를 들면 pageNumber &#x3D; 3일 때 “3 of 10” 과 같은 정보를 표시해줄 수 있어요.</li>
</ul>
<h3 id="2-itemsPerPage-페이지-당-데이터-개수"><a href="#2-itemsPerPage-페이지-당-데이터-개수" class="headerlink" title="2. itemsPerPage (페이지 당 데이터 개수)"></a>2. <code>itemsPerPage</code> (페이지 당 데이터 개수)</h3><ul>
<li>한 페이지에 몇 개의 데이터가 표시되는지 알 수 있습니다.</li>
<li>사용자가 한 페이지에서 보고 싶은 데이터 개수를 조정할 수 있어요.</li>
<li>예를 들면, “30개씩 보기” 버튼을 통해 한번에 보고 싶은 데이터의 개수를 조정할 수 있어요.</li>
</ul>
<h3 id="3-totalElements-전체-데이터-개수"><a href="#3-totalElements-전체-데이터-개수" class="headerlink" title="3. totalElements (전체 데이터 개수)"></a>3. <code>totalElements</code> (전체 데이터 개수)</h3><ul>
<li>전체 데이터 개수를 알 수 있습니다. 전체 데이터 양을 통해 더 많은 데이터가 있는지 혹은 얼마나 남았는지를 파악할 수 있어요.</li>
<li>예를 들면, “총 150개의 항목 중 30개를 표시하고 있어요.” 와 같은 정보를 알려줄 수 있어요.</li>
<li>무한 스크롤을 구현할 때 유용하게 쓰여요!</li>
</ul>
<h3 id="4-totalPages-전체-페이지-수"><a href="#4-totalPages-전체-페이지-수" class="headerlink" title="4. totalPages (전체 페이지 수)"></a>4. <code>totalPages</code> (전체 페이지 수)</h3><ul>
<li>전체 페이지 수를 알 수 있습니다.</li>
<li>totalPages &#x3D; 10 이라면 페이지 이동을 위한 UI를 제공할 수 있어요.</li>
<li>totalPages 데이터를 기반으로 “다음” 버튼을 활성화 할지 비활성화 할지 등의 동작을 결정할 수 있어요.</li>
</ul>
<h2 id="2-페이징-메타데이터를-공통-스키마로-정의하기"><a href="#2-페이징-메타데이터를-공통-스키마로-정의하기" class="headerlink" title="2. 페이징 메타데이터를 공통 스키마로 정의하기"></a>2. 페이징 메타데이터를 공통 스키마로 정의하기</h2><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">components:</span></span><br><span class="line">  <span class="attr">schemas:</span></span><br><span class="line">    <span class="attr">PagingMetadata:</span></span><br><span class="line">      <span class="attr">type:</span> <span class="string">object</span></span><br><span class="line">      <span class="attr">properties:</span></span><br><span class="line">        <span class="attr">pageNumber:</span></span><br><span class="line">          <span class="attr">type:</span> <span class="string">integer</span></span><br><span class="line">        <span class="attr">itemsPerPage:</span></span><br><span class="line">          <span class="attr">type:</span> <span class="string">integer</span></span><br><span class="line">        <span class="attr">totalElements:</span></span><br><span class="line">          <span class="attr">type:</span> <span class="string">integer</span></span><br><span class="line">        <span class="attr">totalPages:</span></span><br><span class="line">          <span class="attr">type:</span> <span class="string">integer</span></span><br><span class="line">      <span class="attr">required:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">pageNumber</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">itemsPerPage</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">totalElements</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">totalPages</span></span><br></pre></td></tr></table></figure>

<p><code>openapi.yaml</code> 에 <code>PagingMetadata</code> 를 공통 스키마로 정의했어요. 페이징 데이터가 필요한 다른 API 에서도  <code>PagingMetadata</code> 를 사용할 수 있게 하려고요.</p>
<h2 id="3-OpenAPI-응답값-수정하기"><a href="#3-OpenAPI-응답값-수정하기" class="headerlink" title="3.  OpenAPI 응답값 수정하기"></a>3.  OpenAPI 응답값 수정하기</h2><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">paths:</span></span><br><span class="line">  <span class="string">/transactions:</span></span><br><span class="line">    <span class="attr">get:</span></span><br><span class="line">      <span class="attr">parameters:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">in:</span> <span class="string">query</span></span><br><span class="line">          <span class="attr">name:</span> <span class="string">page</span></span><br><span class="line">          <span class="attr">schema:</span></span><br><span class="line">            <span class="attr">type:</span> <span class="string">integer</span></span><br><span class="line">            <span class="attr">default:</span> <span class="number">1</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">in:</span> <span class="string">query</span></span><br><span class="line">          <span class="attr">name:</span> <span class="string">size</span></span><br><span class="line">          <span class="attr">schema:</span></span><br><span class="line">            <span class="attr">type:</span> <span class="string">integer</span></span><br><span class="line">            <span class="attr">default:</span> <span class="number">10</span></span><br><span class="line">      <span class="attr">responses:</span></span><br><span class="line">        <span class="attr">&#x27;200&#x27;:</span></span><br><span class="line">          <span class="attr">description:</span> <span class="string">successful</span> <span class="string">operation</span></span><br><span class="line">          <span class="attr">content:</span></span><br><span class="line">            <span class="attr">application/json:</span></span><br><span class="line">              <span class="attr">schema:</span></span><br><span class="line">                <span class="string">$ref:</span> <span class="string">&#x27;#/components/schemas/PagedTransactionResponse&#x27;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><code>/transactions</code> API를 호출하면 <code>ResponseEntity&lt;PagedTransactionResponse&gt;</code> 객체를 응답하게 만들었어요.  이렇게 만든 이유는 <code>PagedTransactionResponse</code> 응답 객체를 아래와 같이 구성하고 싶어서예요!</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PagedTransactionResponse</span> &#123;</span><br><span class="line"></span><br><span class="line">	List&lt;TransactionResponse&gt; content;</span><br><span class="line">	</span><br><span class="line">	PagingMetadata paging;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="4-openapi-yaml-에-PagedTransactionResponse-스키마-추가하기"><a href="#4-openapi-yaml-에-PagedTransactionResponse-스키마-추가하기" class="headerlink" title="4. openapi.yaml 에 PagedTransactionResponse 스키마 추가하기"></a>4. openapi.yaml 에 PagedTransactionResponse 스키마 추가하기</h2><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">components:</span></span><br><span class="line">  <span class="attr">schemas:</span></span><br><span class="line">      <span class="attr">PagedTransactionResponse:</span></span><br><span class="line">	      <span class="attr">type:</span> <span class="string">object</span></span><br><span class="line">	      <span class="attr">properties:</span></span><br><span class="line">	        <span class="attr">content:</span></span><br><span class="line">	          <span class="attr">type:</span> <span class="string">array</span></span><br><span class="line">	          <span class="attr">items:</span></span><br><span class="line">	            <span class="string">$ref:</span> <span class="string">&#x27;#/components/schemas/TransactionResponse&#x27;</span></span><br><span class="line">	        <span class="attr">paging:</span></span><br><span class="line">	          <span class="string">$ref:</span> <span class="string">&#x27;#/components/schemas/PagingMetadata&#x27;</span></span><br><span class="line">	      <span class="attr">required:</span></span><br><span class="line">	        <span class="bullet">-</span> <span class="string">content</span></span><br><span class="line">	        <span class="bullet">-</span> <span class="string">paging</span></span><br></pre></td></tr></table></figure>

<h2 id="5-해당-컨트롤러-확인하기"><a href="#5-해당-컨트롤러-확인하기" class="headerlink" title="5. 해당 컨트롤러 확인하기"></a>5. 해당 컨트롤러 확인하기</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequiredArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TransactionController</span> <span class="keyword">implements</span> <span class="title class_">TransactionApi</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> ResponseEntity&lt;PagedTransactionResponse&gt; <span class="title function_">getAllTransactions</span><span class="params">(Integer page, Integer size)</span> &#123;</span><br><span class="line">        <span class="type">PageRequest</span> <span class="variable">pageable</span> <span class="operator">=</span> PageRequest.of(page, size);</span><br><span class="line">        System.out.println(<span class="string">&quot;pageable = &quot;</span> + pageable);</span><br><span class="line">    </span><br><span class="line">        <span class="keyword">return</span> ResponseEntity.ok(<span class="literal">null</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>짠 😎</p>
<p>OpenAPI Generator 가 페이징 메타정보가 포함된 응답값을 자동으로 생성해주는 것을 확인할 수가 있습니다!</p>
<h1 id="마무리하며"><a href="#마무리하며" class="headerlink" title="마무리하며"></a>마무리하며</h1><p>OpenAPI Generator 로 페이징 처리 하는 방법을 찾아보는 데 생각보다 시간이 많이 걸렸어요. ㅠ_ㅜ…</p>
<p>세 가지 방법 중 <code>springdoc-openapi</code> 의존성을 추가해서 <code>Pageable</code> 객체를 처리하는 방식을 선택하면 관리 포인트가 늘어난다는 점에서 해당 방법은 고려하지 않았어요. 라이브러리 버전에 따라 프로젝트가 실행이 안될 가능성이 높고 외부 라이브러리에 대한 의존성이 강하게 결합되어 있다고 판단했습니다.</p>
<p>저는 OpenaAPI 스펙에 Pageable 관련 파라미터를 직접 정의하는 방법을 선택했습니다. 현재 프로젝트에 페이징 처리가 필요한 API 가 많이 없기 때문에 필요한 파라미터를 직접 정의하는 방식이 적절할 것 같았어요.</p>
<p>페이징 처리를 해야 하는 API가 많아진다면 Pageable 관련 파라미터와 관련된 코드의 중복이 많아질텐데 그때는 Spring에서 제공하는 Pageable 객체를 사용하는 방법을 선택할 것 같아요.</p>
<p>페이징 처리 하는 방법을 알았으니 이제 데이터를 잘 가져오는 일만 남았는데요. 저는 이제 입출금 내역을 조회하는 API 를 만들러 떠납니다. 이 과정에서 생긴 고민 거리들도 공유해보도록 할게요!</p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-9 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Posted&nbsp;2024-09-04</span><span class="level-item">Updated&nbsp;<time dateTime="2024-09-06T05:12:31.977Z" title="9/6/2024, 2:12:31 PM">2024-09-06</time></span><span class="level-item"><a class="link-muted" href="/categories/%EC%86%8C%ED%94%84%ED%8A%B8%EC%9B%A8%EC%96%B4-%EC%95%84%ED%82%A4%ED%85%8D%EC%B2%98/">소프트웨어 아키텍처</a></span><span class="level-item">9 minutes read (About 1356 words)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2024/09/04/%EB%A6%AC%EC%86%8C%EC%8A%A4-%EC%9D%B4%EB%A6%84%EC%9D%80-%EC%96%B4%EB%96%BB%EA%B2%8C-%EC%A7%80%EC%96%B4%EC%95%BC%ED%95%A0%EA%B9%8C/">RESTful API - 리소스 이름은 어떻게 지어야할까?</a></p><div class="content"><h1 id="들어가며"><a href="#들어가며" class="headerlink" title="들어가며"></a>들어가며</h1><p>안녕하세요! 이번 글은 API의 리소스명을 어떻게 지어야하는지에 대한 고민 과정에 대해서 공유하고자 합니다.<br>우선 제가 만들고 있는 서비스에 대해 간략하게 설명드릴게요. 저는 농구 동호회의 어드민 페이지를 만들고 있고 해당 서비스에서 필요한 기능은 크게 두 가지 입니다.</p>
<ul>
<li>재무 관리</li>
<li>회원 관리</li>
</ul>
<p>재무 관리 기능은 동호회 모임 통장과 관련한 기능인데요. 가계부 어플을 생각하면 이해하기 쉬울 거예요. 동호회 운영과 관련한 모든 재정적인 활동 내역을 기록하고 조회할 수 있는 기능입니다. 이 글에서는 재무 관리 기능에 대해서만 다룰 거예요.<br>대쉬보드에 이달의 입금 &amp; 지출 내역 Top3 를 보여주고 싶습니다. 해당 API 엔드포인트를 설계하려고 해요. 그런데 리소스 이름을 어떻게 지어야 할까요?</p>
<h1 id="도메인명으로-작성하면-되지-않나"><a href="#도메인명으로-작성하면-되지-않나" class="headerlink" title="도메인명으로 작성하면 되지 않나?"></a>도메인명으로 작성하면 되지 않나?</h1><p>입출금 내역으로 AccountTransaction 이라는 도메인을 사용하고 있어요. 그렇다면 이달의 입금 내역과 지출 내역을 조회하는 API를 설계할 때 <code>/account-transactions</code> 라는 리소스명을 사용하면 되지 않을까요? 아래와 같이 말이죠.</p>
<h3 id="1-이달의-입금-내역-상위-3개를-조회하는-API"><a href="#1-이달의-입금-내역-상위-3개를-조회하는-API" class="headerlink" title="1. 이달의 입금 내역 상위 3개를 조회하는 API"></a>1. 이달의 입금 내역 상위 3개를 조회하는 API</h3><ul>
<li>HTTP Method: GET</li>
<li>Endpoint: <code>/account-transactions/deposits/top3</code></li>
<li>Query Parameters:<ul>
<li><code>year</code>: 조회할 연도 (예: 2024)</li>
<li><code>month</code>: 조회할 월 (예: 7)</li>
</ul>
</li>
</ul>
<h3 id="2-이달의-지출-내역-상위-3개를-조회하는-API"><a href="#2-이달의-지출-내역-상위-3개를-조회하는-API" class="headerlink" title="2. 이달의 지출 내역 상위 3개를 조회하는 API"></a>2. 이달의 지출 내역 상위 3개를 조회하는 API</h3><ul>
<li>HTTP Method: GET</li>
<li>Endpoint: <code>/account-transactions/expenses/top3</code></li>
<li>Query Parameters:<ul>
<li><code>year</code>: 조회할 연도 (예: 2024)</li>
<li><code>month</code>: 조회할 월 (예: 7)</li>
</ul>
</li>
</ul>
<h1 id="도메인의-관계가-이렇다면"><a href="#도메인의-관계가-이렇다면" class="headerlink" title="도메인의 관계가 이렇다면?"></a>도메인의 관계가 이렇다면?</h1><p><img src="/../image/relationships-between-domains.png" alt="도메인 관계"></p>
<p>모임 통장에서 발생하고 있는 내역을 분류하면 위의 그림과 같아요. 입금 내역 A,B,C와 출금 내역 D,E 라고 설명하겠습니다. 입금 내역 A가 저장이 되면 입출금 내역에 A의 고유 ID와 트랜잭션 타입이 저장됩니다. 입금 내역 A를 조회하고 싶다면 A 테이블을 조회해서 데이터를 가져옵니다.</p>
<p>입출금 내역 테이블에 A의 데이터가 저장되어 있는 게 아니라 테이블의 속성으로 고유 ID와 트랜잭션 타입이 저장되어 있는데 이런 상황에도 <code>/account-transactions</code> 라는 리소스명을 사용해도 되는지 혼란이 왔습니다.</p>
<h1 id="API-사용자의-입장에서-생각해볼까"><a href="#API-사용자의-입장에서-생각해볼까" class="headerlink" title="API 사용자의 입장에서 생각해볼까?"></a>API 사용자의 입장에서 생각해볼까?</h1><p>관점을 바꿔서 생각해봅시다. API 엔드포인트의 네이밍은 특정 도메인 객체가 직접적으로 데이터를 포함하고 있는지 여부보다는 리소스의 의미와 API 사용자에게 전달하는 메시지가 중요해요.</p>
<p><code>/account-transactions</code> 를 사용하는 API 사용자의 입장에서 해당 엔드포인트는 어떨까요?</p>
<ul>
<li>계좌의 거래내역과 관련한 정보를 요청하고 있다</li>
<li>계좌 거래내역이 입금 및 출금과 관련한 메타데이터를 관리하고 있다</li>
<li>계좌 거래 내역의 입금 및 출금 데이터 중 상위 3개의 데이터를 반환한다</li>
<li>2024년, 7월을 파라미터로 전달한다면 2024년 7월 입금 및 출금 데이터 중에서 상위 3개의 데이터를 확인할 수 있다</li>
</ul>
<p>원하는 결과값을 어느 테이블에서 들고 오느냐는 API 사용자의 관심사가 아닙니다. API 사용자가 원하는 결과값을 어떤 방식으로 구현하느냐는 API 제공자의 역할이에요. API 사용자는 결과값을 요청하는 것이 주된 관심사입니다.<br>따라서 API를 설계할 때는 API 사용자에게 직관적이고 명확한 경험을 제공해주는 것이 중요합니다.</p>
<h1 id="마무리하며"><a href="#마무리하며" class="headerlink" title="마무리하며"></a>마무리하며</h1><p>API를 만들 때 했던 고민을 글로 정리해 보니 음… 별거 아니게 느껴지네요. 간단하게 결론이 지어졌어요.</p>
<p>사용자의 입장으로 돌아가자!</p>
<p>서비스의 요구사항들이 <code>입출금 내역</code>으로부터 파생되기 때문에 설계를 할 때도 너무 입출금 내역에만 중점을 뒀던 것 같아요.<br>AccountTransaction 도메인은 처음엔 AccountBook 이었다가 AccountLog 가 되기도 했고 필요한 속성들도 수시로 바뀌었습니다. 도메인도 AccountTransaction(입출금 내역), Deposit(입금 내역), Withdrawal(출금 내역) 로 정했다가 계속해서 변경되었어요.</p>
<p>서비스의 요구사항과 목적을 제대로 정립하지 않아서 하나의 도메인이 여러 책임을 담당하게 되고 때문에 도메인의 변경이 잦아졌습니다. 그에따라 API 엔드포인트도 변경을 해야만 했어요. 서비스의 요구사항을 제대로 정립하기 위해선 도메인 탐구가 선행되어야겠다는 판단을 하게 됐습니다.</p>
<p>다음에는 도메인을 탐구하는 과정에서 생긴 일들을 공유하게 되면 좋겠습니다!</p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-9 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Posted&nbsp;2023-10-30</span><span class="level-item">Updated&nbsp;<time dateTime="2024-09-06T05:28:47.098Z" title="9/6/2024, 2:28:47 PM">2024-09-06</time></span><span class="level-item"><a class="link-muted" href="/categories/%EB%8D%B0%EC%9D%B4%ED%84%B0%EB%B2%A0%EC%9D%B4%EC%8A%A4/">데이터베이스</a></span><span class="level-item">11 minutes read (About 1708 words)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2023/10/30/order-by-%ED%9B%84-group-by-%EB%A5%BC-%ED%95%98%EA%B3%A0-%EC%8B%B6%EC%9D%84-%EB%95%8C/">order_by_후_group_by_를_하고_싶을_때</a></p><div class="content"><h1 id="단순-쿼리-해결-방법을-글로-남기는-이유"><a href="#단순-쿼리-해결-방법을-글로-남기는-이유" class="headerlink" title="단순 쿼리 해결 방법을 글로 남기는 이유"></a>단순 쿼리 해결 방법을 글로 남기는 이유</h1><p>group by 내부 정렬하는 방법을 구글링 한 게 이번이 처음이 아니기 때문입니다. 몇달 전에도 같은 문제로 구글링을 했고 동일한 해결 과정을 거쳤었어요. 구글링하면서 “아, 맞다! 맞다. 맞다. 아 이거 안되지 참….” 을 반복하면서 이건 정리를 하면서 공부해 놓고 넘어가야 다음에 또 반복 안하겠다는 생각이 들었습니다. 그동안 빨리 쿼리 짜서 원하는 데이터가 결과로 나오는 걸 확인하고 다음 스텝으로 넘어 갔었는데 시간 없다는 핑계로 계속 다음 다음만 했다가는 계속 이런 식으로만 개발할 것 같아서 잘 모르고 넘어갔던 빈틈을 채워보려고 합니다.</p>
<h1 id="하고-싶은-것"><a href="#하고-싶은-것" class="headerlink" title="하고 싶은 것"></a>하고 싶은 것</h1><p>배치 로직을 개발해야 하는데 이에 필요한 데이터를 쿼리문으로 들고 와야해요. 필요한 데이터는 <strong>‘보험 아이디 별 최신 데이터 한 건’</strong> 입니다. 회사 데이터를 가져올 수가 없어서 제가 하고 싶은 쿼리를 뽑아낼 수 있는 샘플 데이터를 가지고 왔어요. 해당 케이스에서의 미션은 아래와 같습니다.</p>
<p><strong>⭐️ 미션: product_code(상품코드)별 제일 최근에 등록된 데이터 가져오기</strong></p>
<p><img src="/../image/%ED%95%98%EA%B3%A0%EC%8B%B6%EC%9D%80%EA%B2%83.png" alt="하고싶은것"></p>
<h1 id="원하는-결과"><a href="#원하는-결과" class="headerlink" title="원하는 결과"></a>원하는 결과</h1><p><img src="/../image/%EC%9B%90%ED%95%98%EB%8A%94%EA%B2%B0%EA%B3%BC.png" alt="원하는_결과"></p>
<p>샘플 데이터가 조금 고르지 못한데요. 미션을 성공하려면 id 가 1, 2, 3, 11, 7, 8, 9, 13, 14 번 데이터가 나와야해요. 나머지 데이터는 뒤로하고, 여기서 주의 깊게 봐야할 데이터는 product_code 가 406인 데이터와 378인 데이터입니다.</p>
<p>상품코드 406번의 로그를 보면 ‘상품 등록 → 수정 → 수정 → 수정’ 으로 제일 최근 데이터는 id 가 11번인 데이터 입니다. 상품코드 378번은 id가 13번인 데이터가 나와야 하구요.</p>
<h1 id="왜…-왜-이렇게-나오는데…"><a href="#왜…-왜-이렇게-나오는데…" class="headerlink" title="왜… 왜 이렇게 나오는데…"></a>왜… 왜 이렇게 나오는데…</h1><p>product_code 별로 created_at 을 최신순 정렬을 한 다음에 해당 데이터 row만 뽑으면 내가 원하는 결과를 가져올 수 있겠다 생각하고 쿼리를 짭니다. 쿼리는 아래와 같습니다.</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> id, product_code, log_value, created_at </span><br><span class="line"><span class="keyword">FROM</span> product_sale_log</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> product_code</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> created_at <span class="keyword">DESC</span>;</span><br></pre></td></tr></table></figure>

<p><img src="/../image/%EC%9E%98%EB%AA%BB%EB%90%9C%EA%B2%B0%EA%B3%BC.png" alt="잘못된_결과"></p>
<p>쿼리의 결과를 살펴볼까요? created_at 을 보면 데이터가 최신순으로 정렬되어 있는 것처럼 보이지만 제가 의도한 결과는 아닙니다. 전체 데이터를 최신순으로 정렬하는 게 아니라 일단 데이터를 product_code 별로 묶고, product_code 내에서 최신순으로 정렬한 결과 가장 최근의 데이터 행 하나를 원했던 것이었어요. GROUP BY는 된듯한데 GROUP BY 내에서 정렬은 일어나지 않은 것 같아요. 위의 결과는 product_code 별로 묶을 때 데이터베이스에 저장되어 있는대로 첫번째 row를 기준으로 묶어서 가져온 것이에요.</p>
<p>왜….? 왜 ORDER BY 는 싸그리 무시된 채 GROUP BY 만 적용이 된 걸까요…. query 가 실행되는 순서를 살펴봅시다. 해당 query 를 실행시키면 product_code 를 기준으로 GROUP BY 를 해요. 이 때 이미 각 product_code 별로 첫번째 행을 가져왔어요. 데이터 행에서 id, product_code, log_value, created_at 컬럼을 가져오고, 이렇게 구성된 데이터를 created_at 을 기준으로 ORDER BY 합니다. 그래서 데이터가 저렇게 나온 거죠. 작성한 쿼리대로 데이터는 잘 나왔어요.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">💡 쿼리가 실행되는 순서: **GROUP BY** -&gt; **ORDER BY**</span><br></pre></td></tr></table></figure>

<h1 id="group-by-내부-정렬하기"><a href="#group-by-내부-정렬하기" class="headerlink" title="group by 내부 정렬하기"></a>group by 내부 정렬하기</h1><p>왜 결과가 의도한 대로 나오지 않았는지 알았으니, 이제 원하는 결과를 뽑을 수 있는 쿼리를 짜보도록 합시다. 미션을 다시 떠올려보아요. <strong>‘product_code(상품코드)별 제일 최근에 등록된 데이터 가져오기’</strong></p>
<p>group by → order by 순으로 실행이 되니까 그럼… group by 하기 전에 created_at 컬럼을 최신순으로 order by를 해놓고 이렇게 정렬된 데이터를 대상으로 product_code 로 group by를 하면 원하는 결과가 나오지 않을까요? 쿼리문으로 한번 옮겨볼게요.</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> id, product_code, log_value, created_at </span><br><span class="line"><span class="keyword">FROM</span> (<span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> product_sale_log <span class="keyword">order</span> <span class="keyword">by</span> created_at <span class="keyword">desc</span>) <span class="keyword">as</span> sub</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> product_code;</span><br></pre></td></tr></table></figure>

<p><img src="/../image/group_by_%EB%82%B4%EB%B6%80%EC%A0%95%EB%A0%AC.png" alt="group_by_내부정렬"></p>
<p>378번 상품코드와 406번 상품코드의 로그는 ‘<strong>상품 등록‘</strong> 이에요. 네… 잘못되었습니다. 원하는 결과가 아니에요. FROM 절의 <strong>(select * from product_sale_log order by created_at desc)</strong> 해당 쿼리를 따로 뜯어서 실행시킨 것과 서브 쿼리 내에서 실행결과가 달라요. MySQL은 ORDER BY 가 서브쿼리 안에 있을 때 성능 이슈 문제 때문에 ORDER BY가 무시된다고 합니다.</p>
<h1 id="Rank-와-Partition-By-사용하기"><a href="#Rank-와-Partition-By-사용하기" class="headerlink" title="Rank() 와 Partition By() 사용하기"></a>Rank() 와 Partition By() 사용하기</h1><p>반드시 GROUP BY 를 써서 해결을 해야할 필요가 없었기 때문에 다른 방법을 사용해서 해결하려고 합니다. 순위를 매기는 rank() 함수를 이용해서 product_code 별로 최신순으로 랭킹을 세우고, 랭킹이 1번인 데이터 행을 가져오게 하면 의도한 결과를 낼 수 있을 것 같아요.</p>
<p>해당 쿼리는 아래와 같습니다.</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> id, product_code, log_value, created_at</span><br><span class="line"><span class="keyword">FROM</span> (</span><br><span class="line">        <span class="keyword">select</span> id, product_code, log_value, created_at,</span><br><span class="line">               <span class="built_in">rank</span>() <span class="keyword">over</span> (<span class="keyword">partition</span> <span class="keyword">by</span> product_code <span class="keyword">order</span> <span class="keyword">by</span> created_at <span class="keyword">desc</span> ) rank</span><br><span class="line">        <span class="keyword">from</span> product_sale_log</span><br><span class="line">     ) test</span><br><span class="line"><span class="keyword">where</span></span><br><span class="line">    rank <span class="operator">=</span> <span class="number">1</span></span><br><span class="line"><span class="keyword">order</span> <span class="keyword">by</span> created_at <span class="keyword">desc</span>;</span><br></pre></td></tr></table></figure>

<p><img src="/../image/rank_and_partition_by.png" alt="rank_and_partition_by"></p>
<p>상품코드 378번과 406번의 데이터를 보면 드디어 의도한 결과가 나온 것을 확인할 수 있습니다. select 에 rank 데이터도 확인해보면 랭킹이 1인 데이터를 가져온 것을 확인해볼 수가 있어요.</p>
<h1 id="공부해봐야할-점"><a href="#공부해봐야할-점" class="headerlink" title="공부해봐야할 점"></a>공부해봐야할 점</h1><ol>
<li>Order By 가 서브쿼리에 존재할 때 어떤 성능 이슈가 있는지</li>
<li>w3schools 에서 OrderDetails 테이블을 대상으로 쿼리 테스트를 했을 때는 서브쿼리에 order by 를 적용해서 만든 아래의 쿼리가 잘 적용이 되었어요. 왜 된 건지 그리고 지금 사용하고 있는 db 툴에서는 왜 안되는 건지. 어떨 때 되고 안되는지를 더 알아봐야 될 것 같습니다.</li>
</ol>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-9 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Posted&nbsp;2023-10-15</span><span class="level-item">Updated&nbsp;<time dateTime="2024-09-06T05:21:29.605Z" title="9/6/2024, 2:21:29 PM">2024-09-06</time></span><span class="level-item"><a class="link-muted" href="/categories/hexo/">hexo</a></span><span class="level-item">16 minutes read (About 2386 words)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2023/10/15/GitHub-Pages%EC%99%80-Hexo%EB%A1%9C-%EA%B8%B0%EC%88%A0-%EB%B8%94%EB%A1%9C%EA%B7%B8-%EB%A7%8C%EB%93%A4%EA%B8%B0/">GitHub Pages와 Hexo로 기술 블로그 만들기</a></p><div class="content"><h1 id="블로그-시작하기"><a href="#블로그-시작하기" class="headerlink" title="블로그 시작하기"></a>블로그 시작하기</h1><p>구글링을 하다보면 종종 깃헙 블로그를 보게되는데 뭔가 만들기 어렵고 복잡할 것 같고 이상하게 개발자스러운 느낌이 들었어요. 나도 만들어보고 싶다는 생각’만’ 했었는데  ‘주1회 개발 블로그 작성하기!’ 다짐을 실행하기 위해 깃헙 블로그를 개설합니다.</p>
<h1 id="깃헙-블로그를-사용하려는-이유"><a href="#깃헙-블로그를-사용하려는-이유" class="headerlink" title="깃헙 블로그를 사용하려는 이유"></a>깃헙 블로그를 사용하려는 이유</h1><ul>
<li>도전 정신 - 편의성이 정말 전혀 없어보이지만 그래서 오히려 한번 써보고 싶었어요. 티스토리나 벨로그같은 블로그 시스템은 게시물 등록이라는 행위로 블로그 작성이 끝이나지만, 깃헙 블로그는 하나부터 열까지 다 코드로 작성해야 한다는 얘기를 들어서 경험해보고 싶었어요.</li>
<li>깃헙 잔디 관리 - 기존에는 비쥬얼 스튜디오 코드를 이용해서 md 파일로 TIL를 작성하고 있었어요. 그러다가 팀원들과 공유해야 할 필요성 + 간편함 + 깔끔함을 느끼고 노션으로 갈아탔어요. 이왕 작성하는 TIL와 정보 공유글, 깃헙 블로그로 작성한다면 깃헙에 잔디도 심을 수 있으니 일석이조 아닌가! 라는 생각이 들었어요.</li>
<li>심미성 - 깃헙 + 프레임워크를 사용하면 다양한 테마를 고를 수 있다고 하여 찾아봤더니 마음에 드는 테마를 발견했습니다! 티스토리보다 훨씬 더 다양한 테마가 있어서 블로그를 꾸며보고 싶다는 생각이 들었어요. 꾸준히 작성해보려고 마음 먹은 거 이왕이면 디자인까지 내 마음에 드는 게 있으면 좋잖아요.</li>
</ul>
<h1 id="블로그-프레임워크"><a href="#블로그-프레임워크" class="headerlink" title="블로그 프레임워크"></a>블로그 프레임워크</h1><p>정적 사이트를 만들 수 있는 블로그 프레임워크를 찾아보았고 Jekyll 와 Hexo 중에 어떤 걸 사용할지 고민하다가 Hexo 로 결정을 했어요. 두가지 프레임워크는 다음과 같은 특징을 가지고 있습니다.</p>
<h2 id="Jekyll"><a href="#Jekyll" class="headerlink" title="Jekyll"></a>Jekyll</h2><ul>
<li>루비 기반</li>
<li>사용자가 가장 많음</li>
<li>테마가 다양함</li>
</ul>
<h2 id="Hexo"><a href="#Hexo" class="headerlink" title="Hexo"></a>Hexo</h2><ul>
<li>자바스크립트(Node js) 기반</li>
<li>문서화가 잘 되어 있음</li>
<li>테마가 다양함</li>
</ul>
<p>깃헙 블로그로 구글링을 하면 깃헙 블로그 + Jekyll 조합이 많은데 저는 자바스크립트 기반의 Hexo 로 선택을 했어요. 루비에 대해서 전혀 모르기도 하고 회사에서 Node js 를 배울 기회가 있을 것 같아서 블로그 작성하면서 미리 찍먹해보려고요.</p>
<p>Hexo 에서 제공해주는 테마를 구경하다가 마음에 드는 테마를 발견했어요. 테마 이름은 Matery 입니다. Matery 테마를 어떻게 내 블로그에 적용하고 배포하는지 알아보도록 합시다.</p>
<h1 id="Hexo-로-깃헙에-배포까지"><a href="#Hexo-로-깃헙에-배포까지" class="headerlink" title="Hexo 로 깃헙에 배포까지!"></a>Hexo 로 깃헙에 배포까지!</h1><h2 id="Hexo-가-뭔가요"><a href="#Hexo-가-뭔가요" class="headerlink" title="Hexo 가 뭔가요?"></a>Hexo 가 뭔가요?</h2><p><a target="_blank" rel="noopener" href="https://hexo.io/docs/">Documentation</a></p>
<ul>
<li>Hexo는 빠르고 간단하고 강력한 블로그 프레임워크예요. 마크다운이나 다른 마크업 언어로 게시글을 작성하면 Hexo 는 몇초만에 정적파일을 생성해줍니다.</li>
</ul>
<h2 id="Hexo-설치하기"><a href="#Hexo-설치하기" class="headerlink" title="Hexo 설치하기"></a>Hexo 설치하기</h2><h3 id="Hexo를-설치하기-이전에-필요한-요구사항"><a href="#Hexo를-설치하기-이전에-필요한-요구사항" class="headerlink" title="Hexo를 설치하기 이전에 필요한 요구사항"></a>Hexo를 설치하기 이전에 필요한 요구사항</h3><ul>
<li>Hexo를 설치하는 방법은 아주 쉽고 간단합니다. 아래와 같은 2가지 사항만 준비하면 돼요.</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">﹒Node.js (최소한 Node.js 10.13 버전이 필요하고, 12.0 버전 이상을 추천합니다.)</span><br><span class="line">﹒Git</span><br></pre></td></tr></table></figure>

<ul>
<li>Node.js 와 Git 이 이미 설치가 되어 있다면 바로 Hexo 설치하기 단계로 가시면 됩니다.  (Git 설치는 생략하도록 하겠습니다.)</li>
</ul>
<h3 id="Node-js-설치하기"><a href="#Node-js-설치하기" class="headerlink" title="Node.js 설치하기"></a>Node.js 설치하기</h3><ul>
<li>Homebrew를 이용해서 Node.js를 설치합니다. node 설치가 성공적으로 끝났다면 아래의 명령어를 이용해서 node 버전을 확인해봅니다.</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ brew install node</span><br><span class="line">$ npm -version</span><br></pre></td></tr></table></figure>

<h3 id="Hexo-설치하기-1"><a href="#Hexo-설치하기-1" class="headerlink" title="Hexo 설치하기"></a>Hexo 설치하기</h3><ul>
<li>모든 요구사항을 설치했다면 이제 npm 으로 Hexo를 설치할 수가 있습니다.</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ npm install -g hexo-cli</span><br></pre></td></tr></table></figure>

<h3 id="Hexo-초기화"><a href="#Hexo-초기화" class="headerlink" title="Hexo 초기화"></a>Hexo 초기화</h3><p>Hexo 가 설치 됐다면, 다음 명령어를 실행해서 <folder>에서 Hexo를 초기화해봅시다!</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ hexo init &lt;folder&gt;</span><br><span class="line">$ <span class="built_in">cd</span> &lt;folder&gt;</span><br><span class="line">$ npm install</span><br></pre></td></tr></table></figure>

<ul>
<li><p>저는 디렉토리명을 ‘blog’로 해서 생성했어요. blog 디렉토리로 이동을 해서 리스트를 살펴보겠습니다.</p>
  <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ ~/workspace ▶️ hexo init blog</span><br><span class="line">$ ~/workspace ▶️ <span class="built_in">cd</span> blog</span><br><span class="line">$ ~/workspace/blog ▶️ ll</span><br><span class="line">$ ~/workspace/blog ▶️ npm install</span><br></pre></td></tr></table></figure>

<p>Hexo를 초기화 하고 나면, 프로젝트 폴더는 아래와 같은 구조로 되어있을 거예요. 제 blog 디렉토리 구조를 보시죠.</p>
  <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">_config.landscape.yml</span><br><span class="line">_config.yml</span><br><span class="line">node_modules</span><br><span class="line">package-lock.json</span><br><span class="line">package.json</span><br><span class="line">scaffolds</span><br><span class="line"><span class="built_in">source</span></span><br><span class="line">themes</span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="config-yml-수정"><a href="#config-yml-수정" class="headerlink" title="_config.yml 수정"></a>_config.yml 수정</h3><p>_config.yml 은 사이트 환경설정 파일이에요. 우리는 여기에서 블로그에 대한 대부분의 세팅을 설정 할 수가 있어요. 몇가지 블로그 세팅을 한번 해볼게요!</p>
<ul>
<li><p>환경설정 문서: <a target="_blank" rel="noopener" href="https://hexo.io/docs/configuration">https://hexo.io/docs/configuration</a></p>
<p>참고로 문서를 편집하기 위한 명령어는 아래와 같아요. vim 을 이용해서 yml 파일을 열어볼게요.</p>
  <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ blog ▶️ vim _config.yml</span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="Site"><a href="#Site" class="headerlink" title="Site"></a>Site</h3><p>내 블로그의 타이틀과 서브타이틀, 설명, 작성자를 수정해봅시다.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Site</span></span><br><span class="line">title: 지식 보관소</span><br><span class="line">subtitle: <span class="string">&#x27;주요활동: 자료 수집 및 정돈&#x27;</span></span><br><span class="line">description: <span class="string">&#x27;필요할 때 꺼내쓰기 위해 잘 정리된 자료를 보관하는 곳&#x27;</span></span><br><span class="line">keywords:</span><br><span class="line">author: myname</span><br><span class="line">language: en</span><br><span class="line">timezone: <span class="string">&#x27;&#x27;</span></span><br></pre></td></tr></table></figure>

<h3 id="URL"><a href="#URL" class="headerlink" title="URL"></a>URL</h3><p>URL 도 수정해보겠습니다. url 에는 내 깃헙 블로그 주소를 입력해주면 돼요.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># URL</span></span><br><span class="line">url: https://my_github_username.github.io/</span><br><span class="line">permalink: :year/:month/:day/:title/</span><br><span class="line">permalink_defaults:</span><br><span class="line">pretty_urls:</span><br><span class="line">  trailing_index: <span class="literal">true</span> <span class="comment"># Set to false to remove trailing &#x27;index.html&#x27; from permalinks</span></span><br><span class="line">  trailing_html: <span class="literal">true</span> <span class="comment"># Set to false to remove trailing &#x27;.html&#x27; from permalinks</span></span><br></pre></td></tr></table></figure>

<ul>
<li>먼저 url 부분을 보면 내 깃헙 블로그 주소를 적어야 하는데 우선 <a target="_blank" rel="noopener" href="http://username.github.io/">username.github.io</a> 라는 이름으로 깃헙 레포지토리를 생성해야 해요. (usrname 은 GitHub 계정의 username을 의미합니다.) 레포지토리 생성 후 해당 레포지토리의 주소를 url 부분에 적어주세요.</li>
</ul>
<h2 id="Deployment"><a href="#Deployment" class="headerlink" title="Deployment"></a>Deployment</h2><h3 id="One-command-deployment"><a href="#One-command-deployment" class="headerlink" title="One-command deployment"></a><strong><strong>One-command deployment</strong></strong></h3><p>해당 가이드는 <a target="_blank" rel="noopener" href="https://hexo.io/docs/one-command-deployment">https://hexo.io/docs/one-command-deployment</a> 에서 가져온 내용이에요.</p>
<p>Hexo는 빠르고 쉬운 배포 전략을 제공하고 있는데요, 내 블로그를 서버에 배포하려면 하나의 명령어만 입력하면 끝입니다.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ ~/workspace/blog ▶️ hexo deploy</span><br></pre></td></tr></table></figure>

<ul>
<li>_config.yml 파일에 deploy 부분을 찾아서 실행시켜주는 명령어예요. 그러려면 deploy 부분이 먼저 정의되어 있어야겠죠.</li>
</ul>
<p>_config.yml 파일을 통해서 배포 설정을 할 수가 있습니다. 배포 구성요소에는 type 필드가 반드시 있어야 해요.</p>
<p>여러개의 배포 플러그인을 사용할 수도 있는데요 아래와 같이 type을 작성해주면 Hexo는 작성된 순서대로 플러그인을 실행시켜 줄 거예요.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">deploy:</span><br><span class="line">- <span class="built_in">type</span>: git</span><br><span class="line">  repo:</span><br><span class="line">- <span class="built_in">type</span>: heroku</span><br><span class="line">  repo:</span><br></pre></td></tr></table></figure>

<h3 id="Git"><a href="#Git" class="headerlink" title="Git"></a>Git</h3><p>Git 배포 플러그인을 사용하는 방법을 소개하겠습니다.</p>
<ol>
<li>hexo-deployer-git 을 설치해주세요.</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ ~/workspace/blog ▶️ npm install hexo-deployer-git --save</span><br></pre></td></tr></table></figure>

<ol>
<li>_config.yml 파일을 아래와 같이 수정해 봅시다.</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">deploy:</span><br><span class="line">  <span class="built_in">type</span>: git</span><br><span class="line">  repo: &lt;repository url&gt; <span class="comment"># https://bitbucket.org/JohnSmith/johnsmith.bitbucket.io</span></span><br><span class="line">  branch: [branch]</span><br><span class="line">  message: [message]</span><br></pre></td></tr></table></figure>

<p>예시를 살펴볼까요? Hexo 에서 배포할 때 어떤 레포지토리와 브랜치에 배포를 할 것인지를 설정해주었어요.</p>
<p>$ hexo deploy 명령어를 실행하면 해당 레포지토리의 브랜치로 푸쉬가 됩니다.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">deploy:</span><br><span class="line">  <span class="built_in">type</span>: git</span><br><span class="line">  repo: https://github.com/username/username.github.io</span><br><span class="line">  branch: main</span><br></pre></td></tr></table></figure>

<ol>
<li>deploy 하기 위한 명령어를 입력해줍니다</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$  ~/workspace/blog ▶️ hexo clean</span><br><span class="line">$  ~/workspace/blog ▶️ hexo deploy</span><br></pre></td></tr></table></figure>

<ol>
<li>설정한 깃헙 레포지토리의 ‘Settings’ → ‘Pages’ 탭을 확인해봅니다. Branch 부분이 gh-pages로 되어있는지 확인하고, 그렇지 않다면 변경해줍니다.</li>
<li>블로그가 잘 만들어졌는지 웹페이지를 확인해봐야겠죠? <a target="_blank" rel="noopener" href="http://username.github.io/">username.github.io</a> 로 접속해 확인해봅시다!</li>
</ol>
<h1 id="마치며"><a href="#마치며" class="headerlink" title="마치며"></a>마치며</h1><ul>
<li>새로운 게시글을 등록하려면 매번 hexo clean → hexo deploy 명령어를 입력해야 합니다. GitHub Actions 를 사용해 배포 과정을 자동화할 수 있는 방법이 <a target="_blank" rel="noopener" href="https://hexo.io/docs/github-pages">공식문서</a>에 소개되어 있는데, 따라 만들어보면 좋을 것 같아요.</li>
<li>main 브랜치와 gh-pages 브랜치를 나눠서 관리하는 방법으로 만들어보려다 처참히 실패하였습니다. gh-pages 브랜치에서 게시글 이력 관리를 할 수 있게끔 하고 main 브랜치에 수정 부분을 반영해서 관리하는 것 같은데, 이 부분은 추후에 다시 해보고 어떻게 고쳤는지 작성해보겠습니다.</li>
<li>튜토리얼을 보고 블로그를 만드는 데까지는 시간이 얼마 안걸렸지만 블로그 글로 정리 해보려고 하니 헷갈리는 부분이 많아 구글링 해보고 프로젝트 날렸다가 다시 만들어보고 하다보니 시간이….상당히 많이 걸리네요 ㅠㅠ….</li>
</ul>
</div></article></div></div><div class="column column-left is-3-tablet is-3-desktop is-3-widescreen  order-1"><div class="card widget" data-type="profile"><div class="card-content"><nav class="level"><div class="level-item has-text-centered flex-shrink-1"><div><figure class="image is-128x128 mx-auto mb-2"><img class="avatar is-rounded" src="/img/profile.png" alt="yihyeon"></figure><p class="title is-size-4 is-block" style="line-height:inherit;">yihyeon</p><p class="is-size-6 is-block">지식을 보관하는 아카이브</p><p class="is-size-6 is-flex justify-content-center"><i class="fas fa-map-marker-alt mr-1"></i><span>Seoul</span></p></div></div></nav><nav class="level is-mobile"><div class="level-item has-text-centered is-marginless"><div><p class="heading">Posts</p><a href="/archives"><p class="title">5</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">Categories</p><a href="/categories"><p class="title">4</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">Tags</p><a href="/tags"><p class="title">11</p></a></div></div></nav><div class="level"><a class="level-item button is-primary is-rounded" href="https://github.com/kellyihyeon" target="_blank" rel="me noopener">Follow</a></div><div class="level is-mobile is-multiline"><a class="level-item button is-transparent is-marginless" target="_blank" rel="me noopener" title="Github" href="https://github.com/kellyihyeon"><i class="fab fa-github"></i></a></div></div></div><!--!--><div class="card widget" data-type="categories"><div class="card-content"><div class="menu"><h3 class="menu-label">Categories</h3><ul class="menu-list"><li><a class="level is-mobile" href="/categories/hexo/"><span class="level-start"><span class="level-item">hexo</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/%EB%8D%B0%EC%9D%B4%ED%84%B0%EB%B2%A0%EC%9D%B4%EC%8A%A4/"><span class="level-start"><span class="level-item">데이터베이스</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/%EC%86%8C%ED%94%84%ED%8A%B8%EC%9B%A8%EC%96%B4-%EC%95%84%ED%82%A4%ED%85%8D%EC%B2%98/"><span class="level-start"><span class="level-item">소프트웨어 아키텍처</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/categories/%EC%9D%B8%ED%94%84%EB%9D%BC/"><span class="level-start"><span class="level-item">인프라</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li></ul></div></div></div><div class="card widget" data-type="recent-posts"><div class="card-content"><h3 class="menu-label">Recents</h3><article class="media"><div class="media-content"><p class="date"><time dateTime="2024-10-07T14:56:23.000Z">2024-10-07</time></p><p class="title"><a href="/2024/10/07/Nginx%EB%A1%9C-%EC%8A%A4%ED%94%84%EB%A7%81-%EB%B6%80%ED%8A%B8-8080%EB%B2%88%EC%9C%BC%EB%A1%9C-%ED%8F%AC%ED%8A%B8-%ED%8F%AC%EC%9B%8C%EB%94%A9-%ED%95%98%EA%B8%B0/">Nginx 로 스프링 부트 8080번으로 포트포워딩 하기</a></p><p class="categories"><a href="/categories/%EC%9D%B8%ED%94%84%EB%9D%BC/">인프라</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2024-09-11T08:39:54.000Z">2024-09-11</time></p><p class="title"><a href="/2024/09/11/OpenAPI-Generator%EB%A1%9C-%ED%8E%98%EC%9D%B4%EC%A7%95-%EC%B2%98%EB%A6%AC%EB%8A%94-%EC%96%B4%EB%96%BB%EA%B2%8C-%ED%95%B4/">OpenAPI Generator로 페이징 처리는 어떻게 해? (with Spring)</a></p><p class="categories"><a href="/categories/%EC%86%8C%ED%94%84%ED%8A%B8%EC%9B%A8%EC%96%B4-%EC%95%84%ED%82%A4%ED%85%8D%EC%B2%98/">소프트웨어 아키텍처</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2024-09-04T14:36:03.000Z">2024-09-04</time></p><p class="title"><a href="/2024/09/04/%EB%A6%AC%EC%86%8C%EC%8A%A4-%EC%9D%B4%EB%A6%84%EC%9D%80-%EC%96%B4%EB%96%BB%EA%B2%8C-%EC%A7%80%EC%96%B4%EC%95%BC%ED%95%A0%EA%B9%8C/">RESTful API - 리소스 이름은 어떻게 지어야할까?</a></p><p class="categories"><a href="/categories/%EC%86%8C%ED%94%84%ED%8A%B8%EC%9B%A8%EC%96%B4-%EC%95%84%ED%82%A4%ED%85%8D%EC%B2%98/">소프트웨어 아키텍처</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2023-10-29T15:31:57.000Z">2023-10-30</time></p><p class="title"><a href="/2023/10/30/order-by-%ED%9B%84-group-by-%EB%A5%BC-%ED%95%98%EA%B3%A0-%EC%8B%B6%EC%9D%84-%EB%95%8C/">order_by_후_group_by_를_하고_싶을_때</a></p><p class="categories"><a href="/categories/%EB%8D%B0%EC%9D%B4%ED%84%B0%EB%B2%A0%EC%9D%B4%EC%8A%A4/">데이터베이스</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2023-10-14T18:55:43.000Z">2023-10-15</time></p><p class="title"><a href="/2023/10/15/GitHub-Pages%EC%99%80-Hexo%EB%A1%9C-%EA%B8%B0%EC%88%A0-%EB%B8%94%EB%A1%9C%EA%B7%B8-%EB%A7%8C%EB%93%A4%EA%B8%B0/">GitHub Pages와 Hexo로 기술 블로그 만들기</a></p><p class="categories"><a href="/categories/hexo/">hexo</a></p></div></article></div></div><div class="card widget" data-type="archives"><div class="card-content"><div class="menu"><h3 class="menu-label">Archives</h3><ul class="menu-list"><li><a class="level is-mobile" href="/archives/2024/10/"><span class="level-start"><span class="level-item">October 2024</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2024/09/"><span class="level-start"><span class="level-item">September 2024</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/archives/2023/10/"><span class="level-start"><span class="level-item">October 2023</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li></ul></div></div></div><div class="card widget" data-type="tags"><div class="card-content"><div class="menu"><h3 class="menu-label">Tags</h3><div class="field is-grouped is-grouped-multiline"><div class="control"><a class="tags has-addons" href="/tags/GitHub-Pages/"><span class="tag">GitHub_Pages</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Hexo/"><span class="tag">Hexo</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Nginx/"><span class="tag">Nginx</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/OpenAPI-Generator/"><span class="tag">OpenAPI-Generator</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/RESTful-API/"><span class="tag">RESTful-API</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/group-by/"><span class="tag">group-by</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/mysql/"><span class="tag">mysql</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/order-by/"><span class="tag">order-by</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/partition-by/"><span class="tag">partition-by</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/rank/"><span class="tag">rank</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%ED%8F%AC%ED%8A%B8%ED%8F%AC%EC%9B%8C%EB%94%A9/"><span class="tag">포트포워딩</span><span class="tag">1</span></a></div></div></div></div></div><div class="card widget" data-type="subscribe-email"><div class="card-content"><div class="menu"><h3 class="menu-label">Subscribe for updates</h3><form action="https://feedburner.google.com/fb/a/mailverify" method="post" target="popupwindow" onsubmit="window.open(&#039;https://feedburner.google.com/fb/a/mailverify?uri=&#039;,&#039;popupwindow&#039;,&#039;scrollbars=yes,width=550,height=520&#039;);return true"><input type="hidden" value="" name="uri"><input type="hidden" name="loc" value="en_US"><div class="field has-addons"><div class="control has-icons-left is-expanded"><input class="input" name="email" type="email" placeholder="Email"><span class="icon is-small is-left"><i class="fas fa-envelope"></i></span></div><div class="control"><input class="button" type="submit" value="Subscribe"></div></div></form></div></div></div><div class="card widget"><div class="card-content"><div class="notification is-danger">You need to set <code>client_id</code> and <code>slot_id</code> to show this AD unit. Please set it in <code>_config.yml</code>.</div></div></div><div class="card widget" data-type="subscribe-email"><div class="card-content"><div class="menu"><h3 class="menu-label">follow.it</h3><form action="" method="post" target="_blank"><div class="field has-addons"><div class="control has-icons-left is-expanded"><input class="input" name="email" type="email" placeholder="Email"><span class="icon is-small is-left"><i class="fas fa-envelope"></i></span></div><div class="control"><input class="button" type="submit" value="Subscribe"></div></div></form></div></div></div></div><!--!--></div></div></section><footer class="footer"><div class="container"><div class="level"><div class="level-start"><a class="footer-logo is-block mb-2" href="/"><img src="/img/logo.png" alt="Insight Archive" height="28"></a><p class="is-size-7"><span>&copy; 2024 yihyeon</span>  Powered by <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a> &amp; <a href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank" rel="noopener">Icarus</a></p><p class="is-size-7">© 2019</p></div><div class="level-end"><div class="field has-addons"><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Creative Commons" href="https://creativecommons.org/"><i class="fab fa-creative-commons"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Attribution 4.0 International" href="https://creativecommons.org/licenses/by/4.0/"><i class="fab fa-creative-commons-by"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/ppoffice/hexo-theme-icarus"><i class="fab fa-github"></i></a></p></div></div></div></div></footer><script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment-with-locales.min.js"></script><script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.4/dist/clipboard.min.js" defer></script><script>moment.locale("en");</script><script>var IcarusThemeSettings = {
            article: {
                highlight: {
                    clipboard: true,
                    fold: 'unfolded'
                }
            }
        };</script><script data-pjax src="/js/column.js"></script><script src="/js/animation.js"></script><a id="back-to-top" title="Back to top" href="javascript:;"><i class="fas fa-chevron-up"></i></a><script data-pjax src="/js/back_to_top.js" defer></script><!--!--><!--!--><!--!--><script src="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.js" defer></script><script>window.addEventListener("load", () => {
      window.cookieconsent.initialise({
        type: "info",
        theme: "edgeless",
        static: false,
        position: "bottom-left",
        content: {
          message: "This website uses cookies to improve your experience.",
          dismiss: "Got it!",
          allow: "Allow cookies",
          deny: "Decline",
          link: "Learn more",
          policy: "Cookie Policy",
          href: "https://www.cookiesandyou.com/",
        },
        palette: {
          popup: {
            background: "#edeff5",
            text: "#838391"
          },
          button: {
            background: "#4b81e8"
          },
        },
      });
    });</script><script src="https://cdn.jsdelivr.net/npm/lightgallery@1.10.0/dist/js/lightgallery.min.js" defer></script><script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.8.1/dist/js/jquery.justifiedGallery.min.js" defer></script><script>window.addEventListener("load", () => {
            if (typeof $.fn.lightGallery === 'function') {
                $('.article').lightGallery({ selector: '.gallery-item' });
            }
            if (typeof $.fn.justifiedGallery === 'function') {
                if ($('.justified-gallery > p > .gallery-item').length) {
                    $('.justified-gallery > p > .gallery-item').unwrap();
                }
                $('.justified-gallery').justifiedGallery();
            }
        });</script><!--!--><!--!--><script src="https://cdn.jsdelivr.net/npm/pjax@0.2.8/pjax.min.js"></script><script src="/js/pjax.js"></script><!--!--><!--!--><!--!--><script data-pjax src="/js/main.js" defer></script><div class="searchbox"><div class="searchbox-container"><div class="searchbox-header"><div class="searchbox-input-container"><input class="searchbox-input" type="text" placeholder="Type something..."></div><a class="searchbox-close" href="javascript:;">×</a></div><div class="searchbox-body"></div></div></div><script src="/js/insight.js" defer></script><script>document.addEventListener('DOMContentLoaded', function () {
            loadInsight({"contentUrl":"/content.json"}, {"hint":"Type something...","untitled":"(Untitled)","posts":"Posts","pages":"Pages","categories":"Categories","tags":"Tags"});
        });</script></body></html>